[0m00:51:22.294869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102997e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10516dae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10516d9c0>]}


============================== 00:51:22.299415 | 071f09c4-3d68-4f7f-b32b-97d77773e215 ==============================
[0m00:51:22.299415 [info ] [MainThread]: Running with dbt=1.7.7
[0m00:51:22.299791 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt seed --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:51:22.505214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1006dfc40>]}
[0m00:51:22.555632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a9ab30>]}
[0m00:51:22.559225 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m00:51:22.572566 [debug] [MainThread]: checksum: 54188551c516f4dd1c42b8d9c289f2bf49f18ae42632e2ba36a64ad29fd60da4, vars: {}, profile: , target: , version: 1.7.7
[0m00:51:22.573834 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:51:22.574158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a31450>]}
[0m00:51:23.119040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070dbeb0>]}
[0m00:51:23.144172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070b3130>]}
[0m00:51:23.144506 [info ] [MainThread]: Found 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m00:51:23.144763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070b3250>]}
[0m00:51:23.145705 [info ] [MainThread]: 
[0m00:51:23.146224 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:51:23.146905 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m00:51:23.153590 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m00:51:23.153919 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m00:51:23.154135 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:23.239343 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m00:51:23.240651 [debug] [ThreadPool]: On list_datamart: Close
[0m00:51:23.241776 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m00:51:23.246641 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m00:51:23.246941 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m00:51:23.247181 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:51:23.262877 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m00:51:23.263163 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m00:51:23.263440 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m00:51:23.279267 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m00:51:23.280369 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m00:51:23.281018 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m00:51:23.285164 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:23.285463 [debug] [MainThread]: On master: BEGIN
[0m00:51:23.285714 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:51:23.301526 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m00:51:23.301881 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:23.302257 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:51:23.325196 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m00:51:23.326322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107105d80>]}
[0m00:51:23.326771 [debug] [MainThread]: On master: ROLLBACK
[0m00:51:23.327392 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:23.327714 [debug] [MainThread]: On master: BEGIN
[0m00:51:23.328345 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m00:51:23.328666 [debug] [MainThread]: On master: COMMIT
[0m00:51:23.328978 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:23.329272 [debug] [MainThread]: On master: COMMIT
[0m00:51:23.329782 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m00:51:23.330066 [debug] [MainThread]: On master: Close
[0m00:51:23.330625 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m00:51:23.330936 [info ] [MainThread]: 
[0m00:51:23.334213 [debug] [Thread-1 (]: Began running node seed.points_balance_report.crm__customers
[0m00:51:23.334603 [debug] [Thread-2 (]: Began running node seed.points_balance_report.ledger__points_tranche_snapshots
[0m00:51:23.335035 [info ] [Thread-1 (]: 1 of 2 START seed file datamart.crm__customers ................................. [RUN]
[0m00:51:23.335445 [info ] [Thread-2 (]: 2 of 2 START seed file datamart.ledger__points_tranche_snapshots ............... [RUN]
[0m00:51:23.336093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now seed.points_balance_report.crm__customers)
[0m00:51:23.336687 [debug] [Thread-2 (]: Acquiring new postgres connection 'seed.points_balance_report.ledger__points_tranche_snapshots'
[0m00:51:23.337015 [debug] [Thread-1 (]: Began compiling node seed.points_balance_report.crm__customers
[0m00:51:23.337333 [debug] [Thread-2 (]: Began compiling node seed.points_balance_report.ledger__points_tranche_snapshots
[0m00:51:23.337722 [debug] [Thread-1 (]: Timing info for seed.points_balance_report.crm__customers (compile): 00:51:23.337543 => 00:51:23.337545
[0m00:51:23.338093 [debug] [Thread-2 (]: Timing info for seed.points_balance_report.ledger__points_tranche_snapshots (compile): 00:51:23.337924 => 00:51:23.337925
[0m00:51:23.338411 [debug] [Thread-1 (]: Began executing node seed.points_balance_report.crm__customers
[0m00:51:23.338730 [debug] [Thread-2 (]: Began executing node seed.points_balance_report.ledger__points_tranche_snapshots
[0m00:51:23.365286 [debug] [Thread-1 (]: Using postgres connection "seed.points_balance_report.crm__customers"
[0m00:51:23.367074 [debug] [Thread-2 (]: Using postgres connection "seed.points_balance_report.ledger__points_tranche_snapshots"
[0m00:51:23.367390 [debug] [Thread-1 (]: On seed.points_balance_report.crm__customers: BEGIN
[0m00:51:23.367665 [debug] [Thread-2 (]: On seed.points_balance_report.ledger__points_tranche_snapshots: BEGIN
[0m00:51:23.367937 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:51:23.368190 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m00:51:23.381974 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m00:51:23.382325 [debug] [Thread-2 (]: Using postgres connection "seed.points_balance_report.ledger__points_tranche_snapshots"
[0m00:51:23.382614 [debug] [Thread-2 (]: On seed.points_balance_report.ledger__points_tranche_snapshots: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "seed.points_balance_report.ledger__points_tranche_snapshots"} */
truncate table "datamart"."datamart"."ledger__points_tranche_snapshots"
[0m00:51:23.383328 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m00:51:23.383592 [debug] [Thread-1 (]: Using postgres connection "seed.points_balance_report.crm__customers"
[0m00:51:23.383854 [debug] [Thread-1 (]: On seed.points_balance_report.crm__customers: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "seed.points_balance_report.crm__customers"} */
truncate table "datamart"."datamart"."crm__customers"
[0m00:51:23.387033 [debug] [Thread-2 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m00:51:23.387323 [debug] [Thread-1 (]: SQL status: TRUNCATE TABLE in 0.0 seconds
[0m00:51:23.408794 [debug] [Thread-2 (]: Using postgres connection "seed.points_balance_report.ledger__points_tranche_snapshots"
[0m00:51:23.411732 [debug] [Thread-1 (]: Using postgres connection "seed.points_balance_report.crm__customers"
[0m00:51:23.412007 [debug] [Thread-2 (]: On seed.points_balance_report.ledger__points_tranche_snapshots: 
          insert into "datamart"."datamart"."ledger__points_tranche_snapshots" ("id", "tenant_id", "user_id", "points_balance", "expired_on", "scd_id", "scd_updated_at", "scd_valid_from", "scd_valid_to") values
          (%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s)
      ...
[0m00:51:23.412261 [debug] [Thread-1 (]: On seed.points_balance_report.crm__customers: 
          insert into "datamart"."datamart"."crm__customers" ("id", "external_id", "tenant_id") values
          (%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s)
      ...
[0m00:51:23.419490 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m00:51:23.422956 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.points_balance_report.crm__customers"
[0m00:51:23.423224 [debug] [Thread-2 (]: SQL status: INSERT 0 8 in 0.0 seconds
[0m00:51:23.423820 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.points_balance_report.ledger__points_tranche_snapshots"
[0m00:51:23.434063 [debug] [Thread-2 (]: On seed.points_balance_report.ledger__points_tranche_snapshots: COMMIT
[0m00:51:23.435343 [debug] [Thread-1 (]: On seed.points_balance_report.crm__customers: COMMIT
[0m00:51:23.435588 [debug] [Thread-2 (]: Using postgres connection "seed.points_balance_report.ledger__points_tranche_snapshots"
[0m00:51:23.435838 [debug] [Thread-1 (]: Using postgres connection "seed.points_balance_report.crm__customers"
[0m00:51:23.436074 [debug] [Thread-2 (]: On seed.points_balance_report.ledger__points_tranche_snapshots: COMMIT
[0m00:51:23.436303 [debug] [Thread-1 (]: On seed.points_balance_report.crm__customers: COMMIT
[0m00:51:23.452795 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m00:51:23.453040 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m00:51:23.453612 [debug] [Thread-2 (]: Timing info for seed.points_balance_report.ledger__points_tranche_snapshots (execute): 00:51:23.351991 => 00:51:23.453468
[0m00:51:23.454137 [debug] [Thread-1 (]: Timing info for seed.points_balance_report.crm__customers (execute): 00:51:23.338930 => 00:51:23.454010
[0m00:51:23.454398 [debug] [Thread-2 (]: On seed.points_balance_report.ledger__points_tranche_snapshots: Close
[0m00:51:23.454641 [debug] [Thread-1 (]: On seed.points_balance_report.crm__customers: Close
[0m00:51:23.455122 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a31db0>]}
[0m00:51:23.455883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '071f09c4-3d68-4f7f-b32b-97d77773e215', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107007700>]}
[0m00:51:23.455506 [info ] [Thread-2 (]: 2 of 2 OK loaded seed file datamart.ledger__points_tranche_snapshots ........... [[32mINSERT 8[0m in 0.12s]
[0m00:51:23.456262 [info ] [Thread-1 (]: 1 of 2 OK loaded seed file datamart.crm__customers ............................. [[32mINSERT 4[0m in 0.12s]
[0m00:51:23.456664 [debug] [Thread-2 (]: Finished running node seed.points_balance_report.ledger__points_tranche_snapshots
[0m00:51:23.457005 [debug] [Thread-1 (]: Finished running node seed.points_balance_report.crm__customers
[0m00:51:23.457897 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:23.458142 [debug] [MainThread]: On master: BEGIN
[0m00:51:23.458356 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:51:23.566044 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m00:51:23.566525 [debug] [MainThread]: On master: COMMIT
[0m00:51:23.566848 [debug] [MainThread]: Using postgres connection "master"
[0m00:51:23.567151 [debug] [MainThread]: On master: COMMIT
[0m00:51:23.567871 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m00:51:23.568191 [debug] [MainThread]: On master: Close
[0m00:51:23.568819 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:51:23.569113 [debug] [MainThread]: Connection 'seed.points_balance_report.crm__customers' was properly closed.
[0m00:51:23.569394 [debug] [MainThread]: Connection 'seed.points_balance_report.ledger__points_tranche_snapshots' was properly closed.
[0m00:51:23.569731 [info ] [MainThread]: 
[0m00:51:23.570072 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m00:51:23.570815 [debug] [MainThread]: Command end result
[0m00:51:23.623689 [info ] [MainThread]: 
[0m00:51:23.624224 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:51:23.624608 [info ] [MainThread]: 
[0m00:51:23.624994 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m00:51:23.627686 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 1.3780454, "process_user_time": 1.922907, "process_kernel_time": 0.269089, "process_mem_max_rss": "119603200", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:51:23.628279 [debug] [MainThread]: Command `dbt seed` succeeded at 00:51:23.628144 after 1.38 seconds
[0m00:51:23.628700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102997e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059b3f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107007700>]}
[0m00:51:23.629126 [debug] [MainThread]: Flushing usage events
[0m01:26:22.603846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055e75e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107571b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107571ae0>]}


============================== 01:26:22.611143 | fd16bd5e-f16d-4a28-b900-fe87507fa5da ==============================
[0m01:26:22.611143 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:26:22.611523 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'send_anonymous_usage_stats': 'True'}
[0m01:26:22.806300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a2c550>]}
[0m01:26:22.855804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f96fb0>]}
[0m01:26:22.859517 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:26:22.873269 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:26:22.880853 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:26:22.881251 [debug] [MainThread]: previous checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, current checksum: 54188551c516f4dd1c42b8d9c289f2bf49f18ae42632e2ba36a64ad29fd60da4
[0m01:26:22.881480 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:26:22.881734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a9df90>]}
[0m01:26:23.474859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108487010>]}
[0m01:26:23.482277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108487070>]}
[0m01:26:23.482574 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:26:23.482812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f97bb0>]}
[0m01:26:23.483516 [info ] [MainThread]: 
[0m01:26:23.483955 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:26:23.484511 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:26:23.490274 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:26:23.490559 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:26:23.490758 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:26:23.641472 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:26:23.643271 [debug] [ThreadPool]: On list_datamart: Close
[0m01:26:23.644925 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:26:23.650778 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:26:23.651117 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:26:23.651395 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:26:23.668251 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:26:23.668571 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:26:23.668889 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:26:23.693139 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:26:23.694478 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:26:23.695181 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:26:23.700308 [debug] [MainThread]: Using postgres connection "master"
[0m01:26:23.700701 [debug] [MainThread]: On master: BEGIN
[0m01:26:23.701019 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:26:23.721068 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:26:23.721494 [debug] [MainThread]: Using postgres connection "master"
[0m01:26:23.721970 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:26:23.752530 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:26:23.753993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108487220>]}
[0m01:26:23.754570 [debug] [MainThread]: On master: ROLLBACK
[0m01:26:23.755367 [debug] [MainThread]: Using postgres connection "master"
[0m01:26:23.755788 [debug] [MainThread]: On master: BEGIN
[0m01:26:23.756616 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:26:23.757047 [debug] [MainThread]: On master: COMMIT
[0m01:26:23.757442 [debug] [MainThread]: Using postgres connection "master"
[0m01:26:23.757825 [debug] [MainThread]: On master: COMMIT
[0m01:26:23.758526 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:26:23.758953 [debug] [MainThread]: On master: Close
[0m01:26:23.759798 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:26:23.760249 [info ] [MainThread]: 
[0m01:26:23.765179 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:26:23.765821 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:26:23.766612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:26:23.767048 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:26:23.775962 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:26:23.778048 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:26:23.767313 => 01:26:23.777766
[0m01:26:23.778447 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:26:23.818254 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:26:23.818613 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp012623800477"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  datamart.crm__customers AS customer
LEFT JOIN
  datamart.ledger__points_tranche_snapshots AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:26:23.818883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:26:23.867707 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:26:23.873234 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:26:23.873595 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:26:23.874187 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:26:23.874484 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:26:23.874784 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp012623800477'
        
      order by ordinal_position

  
[0m01:26:23.942005 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:26:23.947514 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:26:23.947957 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:26:23.953366 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:26:23.961252 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:26:23.961649 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:26:23.967394 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:26:23.978954 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:26:23.980032 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:26:23.980377 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            using "points_balance_report__dbt_tmp012623800477"
            where (
                
                    "points_balance_report__dbt_tmp012623800477".tenant_date, customer_id = "datamart"."datamart"."points_balance_report".tenant_date, customer_id
                    
                
                
            );
        
    

    insert into "datamart"."datamart"."points_balance_report" ("id", "external_id", "tenant_id")
    (
        select "id", "external_id", "tenant_id"
        from "points_balance_report__dbt_tmp012623800477"
    )
  
[0m01:26:23.983878 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column points_balance_report.tenant_date does not exist
LINE 9: ...__dbt_tmp012623800477".tenant_date, customer_id = "datamart"...
                                                             ^

[0m01:26:23.984229 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:26:23.985053 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:26:23.778660 => 01:26:23.984870
[0m01:26:23.985387 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:26:24.048745 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column points_balance_report.tenant_date does not exist
  LINE 9: ...__dbt_tmp012623800477".tenant_date, customer_id = "datamart"...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:26:24.049274 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd16bd5e-f16d-4a28-b900-fe87507fa5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108620fa0>]}
[0m01:26:24.049914 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.28s]
[0m01:26:24.050559 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:26:24.051997 [debug] [MainThread]: Using postgres connection "master"
[0m01:26:24.052370 [debug] [MainThread]: On master: BEGIN
[0m01:26:24.052703 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:26:24.079660 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:26:24.080099 [debug] [MainThread]: On master: COMMIT
[0m01:26:24.080417 [debug] [MainThread]: Using postgres connection "master"
[0m01:26:24.080723 [debug] [MainThread]: On master: COMMIT
[0m01:26:24.081602 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:26:24.081914 [debug] [MainThread]: On master: Close
[0m01:26:24.082532 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:26:24.082828 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:26:24.083154 [info ] [MainThread]: 
[0m01:26:24.083501 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m01:26:24.084109 [debug] [MainThread]: Command end result
[0m01:26:24.090763 [info ] [MainThread]: 
[0m01:26:24.091134 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:26:24.091422 [info ] [MainThread]: 
[0m01:26:24.091713 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column points_balance_report.tenant_date does not exist
  LINE 9: ...__dbt_tmp012623800477".tenant_date, customer_id = "datamart"...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:26:24.092003 [info ] [MainThread]: 
[0m01:26:24.092304 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:26:24.094522 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.5272386, "process_user_time": 2.000215, "process_kernel_time": 0.264981, "process_mem_max_rss": "121634816", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:26:24.094946 [debug] [MainThread]: Command `dbt run` failed at 01:26:24.094850 after 1.53 seconds
[0m01:26:24.095251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055e75e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ee5750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079b3250>]}
[0m01:26:24.095554 [debug] [MainThread]: Flushing usage events
[0m01:27:11.468470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10304b5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c71b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c71ae0>]}


============================== 01:27:11.471542 | 0ec66438-473a-4e1f-b67d-a4475bb418da ==============================
[0m01:27:11.471542 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:27:11.471914 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:27:11.610640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10602c550>]}
[0m01:27:11.660172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106596fb0>]}
[0m01:27:11.660963 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:27:11.675155 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:27:11.732444 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:27:11.732872 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:27:11.838483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f0f70>]}
[0m01:27:11.845875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10688e050>]}
[0m01:27:11.846156 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:27:11.846398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10688e380>]}
[0m01:27:11.847091 [info ] [MainThread]: 
[0m01:27:11.847534 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:27:11.848132 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:27:11.854031 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:27:11.854291 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:27:11.854497 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:11.928013 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:27:11.929228 [debug] [ThreadPool]: On list_datamart: Close
[0m01:27:11.930436 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:27:11.934867 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:27:11.935146 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:27:11.935380 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:27:11.952436 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:27:11.952725 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:27:11.953003 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:27:11.971935 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:27:11.972892 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:27:11.973428 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:27:11.977346 [debug] [MainThread]: Using postgres connection "master"
[0m01:27:11.977646 [debug] [MainThread]: On master: BEGIN
[0m01:27:11.977900 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:27:11.993930 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:27:11.994277 [debug] [MainThread]: Using postgres connection "master"
[0m01:27:11.994649 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:27:12.018207 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:27:12.019288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a36c80>]}
[0m01:27:12.019733 [debug] [MainThread]: On master: ROLLBACK
[0m01:27:12.020330 [debug] [MainThread]: Using postgres connection "master"
[0m01:27:12.020653 [debug] [MainThread]: On master: BEGIN
[0m01:27:12.021275 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:27:12.021590 [debug] [MainThread]: On master: COMMIT
[0m01:27:12.021893 [debug] [MainThread]: Using postgres connection "master"
[0m01:27:12.022186 [debug] [MainThread]: On master: COMMIT
[0m01:27:12.022740 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:27:12.023062 [debug] [MainThread]: On master: Close
[0m01:27:12.023679 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:27:12.024029 [info ] [MainThread]: 
[0m01:27:12.026146 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:27:12.026632 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:27:12.027251 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:27:12.027592 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:27:12.035589 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:27:12.036652 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:27:12.027806 => 01:27:12.036467
[0m01:27:12.036971 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:27:12.075540 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:27:12.075966 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp012712057407"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:27:12.076237 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:27:12.102636 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:27:12.107972 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:27:12.108278 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:27:12.108720 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:27:12.108975 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:27:12.109235 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp012712057407'
        
      order by ordinal_position

  
[0m01:27:12.125255 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:27:12.128940 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:27:12.129270 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:27:12.131470 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:27:12.136734 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:27:12.137031 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:27:12.139032 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:27:12.148320 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:27:12.149175 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:27:12.149452 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            using "points_balance_report__dbt_tmp012712057407"
            where (
                
                    "points_balance_report__dbt_tmp012712057407".tenant_date, customer_id = "datamart"."datamart"."points_balance_report".tenant_date, customer_id
                    
                
                
            );
        
    

    insert into "datamart"."datamart"."points_balance_report" ("id", "external_id", "tenant_id")
    (
        select "id", "external_id", "tenant_id"
        from "points_balance_report__dbt_tmp012712057407"
    )
  
[0m01:27:12.151111 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column points_balance_report.tenant_date does not exist
LINE 9: ...__dbt_tmp012712057407".tenant_date, customer_id = "datamart"...
                                                             ^

[0m01:27:12.151397 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:27:12.151968 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:27:12.037160 => 01:27:12.151817
[0m01:27:12.152229 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:27:12.183652 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column points_balance_report.tenant_date does not exist
  LINE 9: ...__dbt_tmp012712057407".tenant_date, customer_id = "datamart"...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:27:12.184051 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ec66438-473a-4e1f-b67d-a4475bb418da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10690c5b0>]}
[0m01:27:12.184530 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.16s]
[0m01:27:12.185004 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:27:12.186068 [debug] [MainThread]: Using postgres connection "master"
[0m01:27:12.186350 [debug] [MainThread]: On master: BEGIN
[0m01:27:12.186594 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:27:12.205296 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:27:12.205674 [debug] [MainThread]: On master: COMMIT
[0m01:27:12.205922 [debug] [MainThread]: Using postgres connection "master"
[0m01:27:12.206152 [debug] [MainThread]: On master: COMMIT
[0m01:27:12.206980 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:27:12.207269 [debug] [MainThread]: On master: Close
[0m01:27:12.207786 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:27:12.208028 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:27:12.208306 [info ] [MainThread]: 
[0m01:27:12.208580 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.36 seconds (0.36s).
[0m01:27:12.209075 [debug] [MainThread]: Command end result
[0m01:27:12.238308 [info ] [MainThread]: 
[0m01:27:12.238696 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:27:12.238946 [info ] [MainThread]: 
[0m01:27:12.239190 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column points_balance_report.tenant_date does not exist
  LINE 9: ...__dbt_tmp012712057407".tenant_date, customer_id = "datamart"...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:27:12.239436 [info ] [MainThread]: 
[0m01:27:12.239686 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:27:12.241838 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.80778134, "process_user_time": 1.56072, "process_kernel_time": 0.230273, "process_mem_max_rss": "121061376", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:27:12.242235 [debug] [MainThread]: Command `dbt run` failed at 01:27:12.242144 after 0.81 seconds
[0m01:27:12.242522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10304b5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10690f250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a5e020>]}
[0m01:27:12.242801 [debug] [MainThread]: Flushing usage events
[0m01:29:11.911705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f6a3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ef5ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ef5b40>]}


============================== 01:29:11.914492 | 9ed722fc-ae67-4a34-a2f4-739cc04c4529 ==============================
[0m01:29:11.914492 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:29:11.914882 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:29:12.050282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ed722fc-ae67-4a34-a2f4-739cc04c4529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053af4f0>]}
[0m01:29:12.099811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ed722fc-ae67-4a34-a2f4-739cc04c4529', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10591a1d0>]}
[0m01:29:12.100501 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:29:12.110937 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:29:12.165001 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:29:12.165488 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:29:12.262161 [error] [MainThread]: Encountered an error:
Compilation Error in model points_balance_report (models/points_balance_report.sql)
  invalid syntax for function call expression
    line 1
      {{ config(
[0m01:29:12.264019 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.38540888, "process_user_time": 1.410706, "process_kernel_time": 0.228077, "process_mem_max_rss": "109084672", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:29:12.264377 [debug] [MainThread]: Command `dbt run` failed at 01:29:12.264292 after 0.39 seconds
[0m01:29:12.264630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f6a3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b403a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b403d0>]}
[0m01:29:12.264879 [debug] [MainThread]: Flushing usage events
[0m01:29:25.073428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071963b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109121ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109121b40>]}


============================== 01:29:25.076443 | 4fd5fa11-a6a6-4b50-b7ce-f24032803cd6 ==============================
[0m01:29:25.076443 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:29:25.076836 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:29:25.217726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095df4f0>]}
[0m01:29:25.267174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b48c70>]}
[0m01:29:25.268019 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:29:25.287557 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:29:25.334418 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:29:25.334888 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:29:25.442869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e50fd0>]}
[0m01:29:25.450148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cee170>]}
[0m01:29:25.450443 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:29:25.450685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cee4a0>]}
[0m01:29:25.451391 [info ] [MainThread]: 
[0m01:29:25.451831 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:29:25.452398 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:29:25.458248 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:29:25.458574 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:29:25.458772 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:29:25.533770 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:29:25.535018 [debug] [ThreadPool]: On list_datamart: Close
[0m01:29:25.536099 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:29:25.540481 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:29:25.540774 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:29:25.541010 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:29:25.557255 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:29:25.557520 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:29:25.557777 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:29:25.579265 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:25.580303 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:29:25.580866 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:29:25.584772 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:25.585100 [debug] [MainThread]: On master: BEGIN
[0m01:29:25.585357 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:29:25.601984 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:29:25.602329 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:25.602714 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:29:25.626866 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:29:25.627948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e96d10>]}
[0m01:29:25.628393 [debug] [MainThread]: On master: ROLLBACK
[0m01:29:25.629029 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:25.629348 [debug] [MainThread]: On master: BEGIN
[0m01:29:25.629971 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:29:25.630290 [debug] [MainThread]: On master: COMMIT
[0m01:29:25.630600 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:25.630894 [debug] [MainThread]: On master: COMMIT
[0m01:29:25.631436 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:29:25.631753 [debug] [MainThread]: On master: Close
[0m01:29:25.632373 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:29:25.632717 [info ] [MainThread]: 
[0m01:29:25.634910 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:29:25.635356 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:29:25.635920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:29:25.636245 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:29:25.644169 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:29:25.645238 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:29:25.636451 => 01:29:25.645047
[0m01:29:25.645580 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:29:25.683660 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:25.684067 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp012925666562"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:29:25.684334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:29:25.719415 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:29:25.724522 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:25.724834 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:29:25.725339 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:29:25.725609 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:25.725883 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp012925666562'
        
      order by ordinal_position

  
[0m01:29:25.743300 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:25.747127 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:25.747449 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:29:25.749637 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:25.755082 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:25.755404 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:29:25.757483 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:25.767448 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:29:25.768222 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:25.768525 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            using "points_balance_report__dbt_tmp012925666562"
            where (
                
                    "points_balance_report__dbt_tmp012925666562".tenant_date, customer_id = "datamart"."datamart"."points_balance_report".tenant_date, customer_id
                    
                
                
            );
        
    

    insert into "datamart"."datamart"."points_balance_report" ("id", "external_id", "tenant_id")
    (
        select "id", "external_id", "tenant_id"
        from "points_balance_report__dbt_tmp012925666562"
    )
  
[0m01:29:25.770239 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column points_balance_report.tenant_date does not exist
LINE 9: ...__dbt_tmp012925666562".tenant_date, customer_id = "datamart"...
                                                             ^

[0m01:29:25.770527 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:29:25.771067 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:29:25.645769 => 01:29:25.770919
[0m01:29:25.771332 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:29:25.816837 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column points_balance_report.tenant_date does not exist
  LINE 9: ...__dbt_tmp012925666562".tenant_date, customer_id = "datamart"...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:29:25.817333 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4fd5fa11-a6a6-4b50-b7ce-f24032803cd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d6efe0>]}
[0m01:29:25.817832 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.18s]
[0m01:29:25.818319 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:29:25.819354 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:25.819645 [debug] [MainThread]: On master: BEGIN
[0m01:29:25.819882 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:29:25.864977 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:29:25.865383 [debug] [MainThread]: On master: COMMIT
[0m01:29:25.865651 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:25.865900 [debug] [MainThread]: On master: COMMIT
[0m01:29:25.866408 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:29:25.866661 [debug] [MainThread]: On master: Close
[0m01:29:25.867165 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:29:25.867408 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:29:25.867674 [info ] [MainThread]: 
[0m01:29:25.867965 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m01:29:25.868461 [debug] [MainThread]: Command end result
[0m01:29:25.874546 [info ] [MainThread]: 
[0m01:29:25.874900 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:29:25.875163 [info ] [MainThread]: 
[0m01:29:25.875429 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column points_balance_report.tenant_date does not exist
  LINE 9: ...__dbt_tmp012925666562".tenant_date, customer_id = "datamart"...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:29:25.875692 [info ] [MainThread]: 
[0m01:29:25.875970 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:29:25.877631 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8426425, "process_user_time": 1.55479, "process_kernel_time": 0.225908, "process_mem_max_rss": "119160832", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:29:25.878087 [debug] [MainThread]: Command `dbt run` failed at 01:29:25.877993 after 0.84 seconds
[0m01:29:25.878383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071963b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e135e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cdbfd0>]}
[0m01:29:25.878669 [debug] [MainThread]: Flushing usage events
[0m01:29:45.016149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10323b5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6db40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6dae0>]}


============================== 01:29:45.019113 | 7b6238be-f5a6-4bb1-82d6-c74d5aec5f49 ==============================
[0m01:29:45.019113 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:29:45.019484 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'debug': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:29:45.157491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7b6238be-f5a6-4bb1-82d6-c74d5aec5f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120150550>]}
[0m01:29:45.207280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7b6238be-f5a6-4bb1-82d6-c74d5aec5f49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1202aefb0>]}
[0m01:29:45.208024 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:29:45.218720 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:29:45.271412 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:29:45.271906 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:29:45.363931 [error] [MainThread]: Encountered an error:
Compilation Error in model points_balance_report (models/points_balance_report.sql)
  invalid syntax for function call expression
    line 1
      {{ config(
[0m01:29:45.365866 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.3845307, "process_user_time": 1.415963, "process_kernel_time": 0.216305, "process_mem_max_rss": "109527040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:29:45.366212 [debug] [MainThread]: Command `dbt run` failed at 01:29:45.366131 after 0.38 seconds
[0m01:29:45.366468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10323b5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a0c340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a0c370>]}
[0m01:29:45.366706 [debug] [MainThread]: Flushing usage events
[0m01:29:54.585497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107383a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109309a80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109309a20>]}


============================== 01:29:54.588352 | 7ecf4870-79ec-48c3-8e4d-2d5ac7086009 ==============================
[0m01:29:54.588352 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:29:54.588727 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:29:54.729882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109309930>]}
[0m01:29:54.779739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d2d930>]}
[0m01:29:54.780498 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:29:54.791737 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:29:54.842258 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:29:54.842731 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:29:54.948740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a038eb0>]}
[0m01:29:54.956012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed6050>]}
[0m01:29:54.956312 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:29:54.956557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ed6380>]}
[0m01:29:54.957268 [info ] [MainThread]: 
[0m01:29:54.957716 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:29:54.958288 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:29:54.964203 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:29:54.964475 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:29:54.964686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:29:55.044425 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:29:55.045654 [debug] [ThreadPool]: On list_datamart: Close
[0m01:29:55.046860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:29:55.051460 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:29:55.051745 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:29:55.051997 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:29:55.071561 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:29:55.071857 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:29:55.072146 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:29:55.097822 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:55.098874 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:29:55.099415 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:29:55.103672 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:55.104037 [debug] [MainThread]: On master: BEGIN
[0m01:29:55.104329 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:29:55.114819 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:29:55.115169 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:55.115556 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:29:55.139349 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:29:55.140439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a07ea70>]}
[0m01:29:55.140886 [debug] [MainThread]: On master: ROLLBACK
[0m01:29:55.141492 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:55.141815 [debug] [MainThread]: On master: BEGIN
[0m01:29:55.142439 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:29:55.142763 [debug] [MainThread]: On master: COMMIT
[0m01:29:55.143069 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:55.143365 [debug] [MainThread]: On master: COMMIT
[0m01:29:55.143911 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:29:55.144231 [debug] [MainThread]: On master: Close
[0m01:29:55.144841 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:29:55.145193 [info ] [MainThread]: 
[0m01:29:55.147406 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:29:55.147921 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:29:55.148525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:29:55.148861 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:29:55.157124 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:29:55.158262 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:29:55.149072 => 01:29:55.158058
[0m01:29:55.158593 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:29:55.196714 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:55.197093 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp012955179757"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:29:55.197362 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:29:55.228296 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:29:55.233479 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:55.233805 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:29:55.234291 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:29:55.234570 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:55.234853 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp012955179757'
        
      order by ordinal_position

  
[0m01:29:55.253958 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:55.257545 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:55.257867 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:29:55.260072 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:55.265427 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:55.265752 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:29:55.267843 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:29:55.277485 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:29:55.279047 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:29:55.279318 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      

    insert into "datamart"."datamart"."points_balance_report" ("id", "external_id", "tenant_id")
    (
        select "id", "external_id", "tenant_id"
        from "points_balance_report__dbt_tmp012955179757"
    )
  
[0m01:29:55.280917 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "id" does not exist
LINE 7:         select "id", "external_id", "tenant_id"
                       ^
HINT:  There is a column named "id" in table "points_balance_report", but it cannot be referenced from this part of the query.

[0m01:29:55.281205 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:29:55.281752 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:29:55.158785 => 01:29:55.281604
[0m01:29:55.282010 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:29:55.301210 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column "id" does not exist
  LINE 7:         select "id", "external_id", "tenant_id"
                         ^
  HINT:  There is a column named "id" in table "points_balance_report", but it cannot be referenced from this part of the query.
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:29:55.301597 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ecf4870-79ec-48c3-8e4d-2d5ac7086009', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1150c0>]}
[0m01:29:55.302036 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.15s]
[0m01:29:55.302469 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:29:55.303482 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:55.303772 [debug] [MainThread]: On master: BEGIN
[0m01:29:55.304012 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:29:55.315574 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:29:55.315901 [debug] [MainThread]: On master: COMMIT
[0m01:29:55.316146 [debug] [MainThread]: Using postgres connection "master"
[0m01:29:55.316374 [debug] [MainThread]: On master: COMMIT
[0m01:29:55.316814 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:29:55.317064 [debug] [MainThread]: On master: Close
[0m01:29:55.317534 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:29:55.317761 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:29:55.318013 [info ] [MainThread]: 
[0m01:29:55.318289 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.36 seconds (0.36s).
[0m01:29:55.318761 [debug] [MainThread]: Command end result
[0m01:29:55.325598 [info ] [MainThread]: 
[0m01:29:55.325982 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:29:55.326230 [info ] [MainThread]: 
[0m01:29:55.326499 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column "id" does not exist
  LINE 7:         select "id", "external_id", "tenant_id"
                         ^
  HINT:  There is a column named "id" in table "points_balance_report", but it cannot be referenced from this part of the query.
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:29:55.326751 [info ] [MainThread]: 
[0m01:29:55.327007 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:29:55.328939 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.7788366, "process_user_time": 1.560986, "process_kernel_time": 0.226549, "process_mem_max_rss": "120373248", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:29:55.329344 [debug] [MainThread]: Command `dbt run` failed at 01:29:55.329256 after 0.78 seconds
[0m01:29:55.329623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107383a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d2d930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a116aa0>]}
[0m01:29:55.329887 [debug] [MainThread]: Flushing usage events
[0m01:30:18.993961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047a7610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10726db10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10726dab0>]}


============================== 01:30:18.996960 | 34158690-35da-41f8-ae71-464e4076188c ==============================
[0m01:30:18.996960 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:30:18.997351 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'send_anonymous_usage_stats': 'True'}
[0m01:30:19.134976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34158690-35da-41f8-ae71-464e4076188c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062f3be0>]}
[0m01:30:19.184580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34158690-35da-41f8-ae71-464e4076188c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107de8c10>]}
[0m01:30:19.185331 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:30:19.195923 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:30:19.247323 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:30:19.247785 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:30:19.339136 [error] [MainThread]: Encountered an error:
Compilation Error in model points_balance_report (models/points_balance_report.sql)
  invalid syntax for function call expression
    line 1
      {{ config(
[0m01:30:19.341008 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.38601133, "process_user_time": 1.41677, "process_kernel_time": 0.214148, "process_mem_max_rss": "109264896", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:30:19.341390 [debug] [MainThread]: Command `dbt run` failed at 01:30:19.341304 after 0.39 seconds
[0m01:30:19.341645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047a7610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11000c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11000c340>]}
[0m01:30:19.341891 [debug] [MainThread]: Flushing usage events
[0m01:30:26.228837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a9b700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a25a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a259f0>]}


============================== 01:30:26.231691 | 5bb179c6-153d-4349-bc9e-23b8cfd61254 ==============================
[0m01:30:26.231691 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:30:26.232061 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'send_anonymous_usage_stats': 'True'}
[0m01:30:26.368743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a25900>]}
[0m01:30:26.418300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10944d330>]}
[0m01:30:26.419111 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:30:26.429632 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:30:26.480992 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:30:26.481455 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:30:26.589098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109750e80>]}
[0m01:30:26.614557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095f20e0>]}
[0m01:30:26.614890 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:30:26.615155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095f2350>]}
[0m01:30:26.615940 [info ] [MainThread]: 
[0m01:30:26.616414 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:30:26.617038 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:30:26.623328 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:30:26.623610 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:30:26.623828 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:26.696296 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:30:26.697474 [debug] [ThreadPool]: On list_datamart: Close
[0m01:30:26.698614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:30:26.703052 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:30:26.703344 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:30:26.703586 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:26.721829 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:30:26.722121 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:30:26.722404 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:30:26.744905 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:30:26.745952 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:30:26.746542 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:30:26.750802 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:26.751138 [debug] [MainThread]: On master: BEGIN
[0m01:30:26.751411 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:30:26.766826 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:30:26.767183 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:26.767567 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:30:26.790082 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:30:26.791180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10979ea40>]}
[0m01:30:26.791630 [debug] [MainThread]: On master: ROLLBACK
[0m01:30:26.792245 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:26.792568 [debug] [MainThread]: On master: BEGIN
[0m01:30:26.793207 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:30:26.793526 [debug] [MainThread]: On master: COMMIT
[0m01:30:26.793839 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:26.794136 [debug] [MainThread]: On master: COMMIT
[0m01:30:26.794676 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:30:26.794997 [debug] [MainThread]: On master: Close
[0m01:30:26.795615 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:30:26.795967 [info ] [MainThread]: 
[0m01:30:26.798245 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:30:26.798769 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:30:26.799411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:30:26.799750 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:30:26.807961 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:30:26.809181 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:30:26.799961 => 01:30:26.808975
[0m01:30:26.809547 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:30:26.847729 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:26.848107 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp013026830670"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:30:26.848372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:26.888039 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:30:26.893149 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:26.893469 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:30:26.893994 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:30:26.894270 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:26.894545 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp013026830670'
        
      order by ordinal_position

  
[0m01:30:26.913558 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:30:26.917480 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:26.917807 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:30:26.920114 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:30:26.925734 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:26.926056 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:30:26.928148 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:30:26.936647 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:30:26.937461 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:26.937759 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      insert into "datamart"."datamart"."points_balance_report" ("id", "external_id", "tenant_id")
    (
        select "id", "external_id", "tenant_id"
        from "points_balance_report__dbt_tmp013026830670"
    )


  
[0m01:30:26.939505 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "id" does not exist
LINE 5:         select "id", "external_id", "tenant_id"
                       ^
HINT:  There is a column named "id" in table "points_balance_report", but it cannot be referenced from this part of the query.

[0m01:30:26.939810 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:30:26.940417 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:30:26.809741 => 01:30:26.940258
[0m01:30:26.940695 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:30:26.970192 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column "id" does not exist
  LINE 5:         select "id", "external_id", "tenant_id"
                         ^
  HINT:  There is a column named "id" in table "points_balance_report", but it cannot be referenced from this part of the query.
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:30:26.970656 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5bb179c6-153d-4349-bc9e-23b8cfd61254', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109422b60>]}
[0m01:30:26.971142 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.17s]
[0m01:30:26.971624 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:30:26.972668 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:26.972939 [debug] [MainThread]: On master: BEGIN
[0m01:30:26.973181 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:30:26.988806 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:30:26.989171 [debug] [MainThread]: On master: COMMIT
[0m01:30:26.989440 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:26.989695 [debug] [MainThread]: On master: COMMIT
[0m01:30:26.990157 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:30:26.990430 [debug] [MainThread]: On master: Close
[0m01:30:26.990964 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:30:26.991235 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:30:26.991518 [info ] [MainThread]: 
[0m01:30:26.991838 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.38 seconds (0.38s).
[0m01:30:26.992349 [debug] [MainThread]: Command end result
[0m01:30:26.999253 [info ] [MainThread]: 
[0m01:30:26.999641 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:30:26.999889 [info ] [MainThread]: 
[0m01:30:27.000137 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column "id" does not exist
  LINE 5:         select "id", "external_id", "tenant_id"
                         ^
  HINT:  There is a column named "id" in table "points_balance_report", but it cannot be referenced from this part of the query.
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:30:27.000386 [info ] [MainThread]: 
[0m01:30:27.000631 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:30:27.002735 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.80671626, "process_user_time": 1.563953, "process_kernel_time": 0.227289, "process_mem_max_rss": "120143872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:30:27.003124 [debug] [MainThread]: Command `dbt run` failed at 01:30:27.003034 after 0.81 seconds
[0m01:30:27.003408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a9b700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109673c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f50dc0>]}
[0m01:30:27.003695 [debug] [MainThread]: Flushing usage events
[0m01:30:43.653197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a57b760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db6dab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db6da50>]}


============================== 01:30:43.662699 | 512f9d0b-abad-4860-9bd5-3d29390096b1 ==============================
[0m01:30:43.662699 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:30:43.663781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'send_anonymous_usage_stats': 'True'}
[0m01:30:44.127835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db6d960>]}
[0m01:30:44.192897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e409bd0>]}
[0m01:30:44.272888 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:30:44.290494 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:30:44.601629 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:30:44.602603 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:30:44.804408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e710ee0>]}
[0m01:30:44.832403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5b2080>]}
[0m01:30:44.832880 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:30:44.833203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e5b23b0>]}
[0m01:30:44.834180 [info ] [MainThread]: 
[0m01:30:44.834794 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:30:44.835695 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:30:44.843758 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:30:44.844083 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:30:44.844326 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:45.195684 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:30:45.198706 [debug] [ThreadPool]: On list_datamart: Close
[0m01:30:45.201514 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:30:45.210336 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:30:45.210895 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:30:45.211312 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:45.234781 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:30:45.235440 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:30:45.235940 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:30:45.264229 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:30:45.266279 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:30:45.267241 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:30:45.273980 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:45.274487 [debug] [MainThread]: On master: BEGIN
[0m01:30:45.274848 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:30:45.380296 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:30:45.381789 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:45.382710 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:30:45.482064 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:30:45.484510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e75ea70>]}
[0m01:30:45.485446 [debug] [MainThread]: On master: ROLLBACK
[0m01:30:45.486770 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:45.487493 [debug] [MainThread]: On master: BEGIN
[0m01:30:45.488818 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:30:45.489372 [debug] [MainThread]: On master: COMMIT
[0m01:30:45.489853 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:45.490312 [debug] [MainThread]: On master: COMMIT
[0m01:30:45.491344 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:30:45.491969 [debug] [MainThread]: On master: Close
[0m01:30:45.493080 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:30:45.493652 [info ] [MainThread]: 
[0m01:30:45.501562 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:30:45.502425 [info ] [Thread-1 (]: 1 of 1 START sql table model datamart.points_balance_report .................... [RUN]
[0m01:30:45.503366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:30:45.503877 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:30:45.514548 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:30:45.515887 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:30:45.504187 => 01:30:45.515571
[0m01:30:45.516375 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:30:45.547829 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:30:45.549257 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:45.549560 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:30:45.549829 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.571557 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:30:45.571959 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:45.572275 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

  
    

  create  table "datamart"."datamart"."points_balance_report__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
[0m01:30:45.636881 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:30:45.643312 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:45.643759 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */
alter table "datamart"."datamart"."points_balance_report" rename to "points_balance_report__dbt_backup"
[0m01:30:45.645939 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m01:30:45.648687 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:45.649054 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */
alter table "datamart"."datamart"."points_balance_report__dbt_tmp" rename to "points_balance_report"
[0m01:30:45.651123 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m01:30:45.667772 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:30:45.668181 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:45.668461 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:30:45.763926 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:30:45.771123 [debug] [Thread-1 (]: Applying DROP to: "datamart"."datamart"."points_balance_report__dbt_backup"
[0m01:30:45.775932 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:30:45.776380 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */
drop table if exists "datamart"."datamart"."points_balance_report__dbt_backup" cascade
[0m01:30:45.793178 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m01:30:45.794885 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:30:45.516627 => 01:30:45.794656
[0m01:30:45.795456 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:30:45.796392 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '512f9d0b-abad-4860-9bd5-3d29390096b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7c5a80>]}
[0m01:30:45.797023 [info ] [Thread-1 (]: 1 of 1 OK created sql table model datamart.points_balance_report ............... [[32mSELECT 4[0m in 0.29s]
[0m01:30:45.797611 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:30:45.799202 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:45.799608 [debug] [MainThread]: On master: BEGIN
[0m01:30:45.799906 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:30:45.899971 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:30:45.900696 [debug] [MainThread]: On master: COMMIT
[0m01:30:45.901165 [debug] [MainThread]: Using postgres connection "master"
[0m01:30:45.901580 [debug] [MainThread]: On master: COMMIT
[0m01:30:45.902748 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:30:45.903325 [debug] [MainThread]: On master: Close
[0m01:30:45.904337 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:30:45.904794 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:30:45.905251 [info ] [MainThread]: 
[0m01:30:45.905716 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.07 seconds (1.07s).
[0m01:30:45.906503 [debug] [MainThread]: Command end result
[0m01:30:46.158473 [info ] [MainThread]: 
[0m01:30:46.160041 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:30:46.160813 [info ] [MainThread]: 
[0m01:30:46.161517 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:30:46.222294 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.9144735, "process_user_time": 2.199294, "process_kernel_time": 0.431526, "process_mem_max_rss": "123420672", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:30:46.223512 [debug] [MainThread]: Command `dbt run` succeeded at 01:30:46.223298 after 2.92 seconds
[0m01:30:46.224131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a57b760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e57f970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e818c40>]}
[0m01:30:46.224681 [debug] [MainThread]: Flushing usage events
[0m01:30:59.902819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a57be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d26db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d26db10>]}


============================== 01:30:59.906626 | 39e27d22-f5a9-4a09-8b31-cf5f219fc3e3 ==============================
[0m01:30:59.906626 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:30:59.907183 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'send_anonymous_usage_stats': 'True'}
[0m01:31:00.258755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d67c040>]}
[0m01:31:00.313296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11db988e0>]}
[0m01:31:00.318945 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:31:00.373627 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:31:00.722483 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:31:00.723439 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:31:00.844213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de9cfa0>]}
[0m01:31:01.054756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd3e140>]}
[0m01:31:01.055712 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:31:01.056341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd3e470>]}
[0m01:31:01.058599 [info ] [MainThread]: 
[0m01:31:01.059987 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:31:01.061466 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:31:01.074284 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:31:01.074867 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:31:01.075220 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:31:01.266540 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m01:31:01.270815 [debug] [ThreadPool]: On list_datamart: Close
[0m01:31:01.274461 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:31:01.284394 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:31:01.284981 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:31:01.285662 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:31:01.307032 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:31:01.307633 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:31:01.308120 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:31:01.335334 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:31:01.337431 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:31:01.338463 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:31:01.345975 [debug] [MainThread]: Using postgres connection "master"
[0m01:31:01.346531 [debug] [MainThread]: On master: BEGIN
[0m01:31:01.346950 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:31:01.367120 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:31:01.367698 [debug] [MainThread]: Using postgres connection "master"
[0m01:31:01.368259 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:31:01.398917 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:31:01.400470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dee6cb0>]}
[0m01:31:01.401204 [debug] [MainThread]: On master: ROLLBACK
[0m01:31:01.402024 [debug] [MainThread]: Using postgres connection "master"
[0m01:31:01.402431 [debug] [MainThread]: On master: BEGIN
[0m01:31:01.403273 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:31:01.403675 [debug] [MainThread]: On master: COMMIT
[0m01:31:01.404057 [debug] [MainThread]: Using postgres connection "master"
[0m01:31:01.404414 [debug] [MainThread]: On master: COMMIT
[0m01:31:01.405217 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:31:01.405653 [debug] [MainThread]: On master: Close
[0m01:31:01.406551 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:31:01.407052 [info ] [MainThread]: 
[0m01:31:01.410913 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:31:01.411615 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:31:01.412662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:31:01.413421 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:31:01.425466 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:31:01.427514 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:31:01.413779 => 01:31:01.427181
[0m01:31:01.427987 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:31:01.472608 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.473019 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp013101453022"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:31:01.473294 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:31:01.662636 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:31:01.676293 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.676939 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:31:01.678196 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:31:01.678896 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.679438 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp013101453022'
        
      order by ordinal_position

  
[0m01:31:01.717298 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:31:01.726025 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.726789 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:31:01.732503 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:31:01.743115 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.743769 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:31:01.749214 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:31:01.763591 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:31:01.765330 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.765730 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp013101453022"
    )


  
[0m01:31:01.771390 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:31:01.784355 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:31:01.784847 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:31:01.785177 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:31:01.786978 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:31:01.787814 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:31:01.428240 => 01:31:01.787633
[0m01:31:01.788156 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:31:01.788773 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39e27d22-f5a9-4a09-8b31-cf5f219fc3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd2f580>]}
[0m01:31:01.789249 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.38s]
[0m01:31:01.789706 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:31:01.790839 [debug] [MainThread]: Using postgres connection "master"
[0m01:31:01.791148 [debug] [MainThread]: On master: BEGIN
[0m01:31:01.791491 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:31:01.921595 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:31:01.922232 [debug] [MainThread]: On master: COMMIT
[0m01:31:01.922680 [debug] [MainThread]: Using postgres connection "master"
[0m01:31:01.923097 [debug] [MainThread]: On master: COMMIT
[0m01:31:01.923992 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:31:01.924601 [debug] [MainThread]: On master: Close
[0m01:31:01.925774 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:31:01.926424 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:31:01.926941 [info ] [MainThread]: 
[0m01:31:01.927437 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m01:31:01.928228 [debug] [MainThread]: Command end result
[0m01:31:01.946991 [info ] [MainThread]: 
[0m01:31:01.947540 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:31:01.947917 [info ] [MainThread]: 
[0m01:31:01.948294 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:31:01.950883 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1553278, "process_user_time": 2.104358, "process_kernel_time": 0.389687, "process_mem_max_rss": "125206528", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:31:01.951671 [debug] [MainThread]: Command `dbt run` succeeded at 01:31:01.951490 after 2.16 seconds
[0m01:31:01.952122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a57be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de5e9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd2fbe0>]}
[0m01:31:01.952537 [debug] [MainThread]: Flushing usage events
[0m01:36:56.356756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048463b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11026dba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11026db40>]}


============================== 01:36:56.409746 | 5c9085d4-7408-49ea-9aaf-92793a430934 ==============================
[0m01:36:56.409746 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:36:56.410615 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles --full-refresh", 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:36:56.735156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11062f4f0>]}
[0m01:36:56.790779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b961d0>]}
[0m01:36:56.792566 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:36:56.805454 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:36:57.254006 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:36:57.254680 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:36:57.374240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ea0fd0>]}
[0m01:36:57.619513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8a170>]}
[0m01:36:57.621346 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:36:57.622385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8a4a0>]}
[0m01:36:57.625032 [info ] [MainThread]: 
[0m01:36:57.626518 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:36:57.628498 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:36:57.642907 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:36:57.643461 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:36:57.643863 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:36:57.963389 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:36:57.967825 [debug] [ThreadPool]: On list_datamart: Close
[0m01:36:57.971206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:36:57.980903 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:36:57.981506 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:36:57.981998 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:36:58.017289 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:36:58.017904 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:36:58.018451 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:36:58.041255 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m01:36:58.043790 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:36:58.044903 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:36:58.053109 [debug] [MainThread]: Using postgres connection "master"
[0m01:36:58.053742 [debug] [MainThread]: On master: BEGIN
[0m01:36:58.054237 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:36:58.076254 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:36:58.076886 [debug] [MainThread]: Using postgres connection "master"
[0m01:36:58.077558 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:36:58.110935 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:36:58.113998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eead40>]}
[0m01:36:58.115451 [debug] [MainThread]: On master: ROLLBACK
[0m01:36:58.116853 [debug] [MainThread]: Using postgres connection "master"
[0m01:36:58.117370 [debug] [MainThread]: On master: BEGIN
[0m01:36:58.118319 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:36:58.118803 [debug] [MainThread]: On master: COMMIT
[0m01:36:58.119233 [debug] [MainThread]: Using postgres connection "master"
[0m01:36:58.119645 [debug] [MainThread]: On master: COMMIT
[0m01:36:58.120384 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:36:58.120825 [debug] [MainThread]: On master: Close
[0m01:36:58.121759 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:36:58.122258 [info ] [MainThread]: 
[0m01:36:58.126096 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:36:58.126935 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:36:58.127905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:36:58.128452 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:36:58.142483 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:36:58.144141 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:36:58.128791 => 01:36:58.143790
[0m01:36:58.144684 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:36:58.189280 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:36:58.190310 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:36:58.190616 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:36:58.190882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:58.303736 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:36:58.304396 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:36:58.305005 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
  
    

  create  table "datamart"."datamart"."points_balance_report"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:36:58.362336 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:36:58.387420 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:36:58.387928 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:36:58.388322 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:36:58.391327 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:36:58.392457 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:36:58.144974 => 01:36:58.392210
[0m01:36:58.392879 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:36:58.393737 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c9085d4-7408-49ea-9aaf-92793a430934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dbecb0>]}
[0m01:36:58.394422 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mSELECT 4[0m in 0.27s]
[0m01:36:58.395020 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:36:58.396852 [debug] [MainThread]: Using postgres connection "master"
[0m01:36:58.397392 [debug] [MainThread]: On master: BEGIN
[0m01:36:58.397731 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:36:58.542704 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:36:58.543722 [debug] [MainThread]: On master: COMMIT
[0m01:36:58.544380 [debug] [MainThread]: Using postgres connection "master"
[0m01:36:58.545005 [debug] [MainThread]: On master: COMMIT
[0m01:36:58.546176 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:36:58.546796 [debug] [MainThread]: On master: Close
[0m01:36:58.547953 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:36:58.548460 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:36:58.549022 [info ] [MainThread]: 
[0m01:36:58.549612 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m01:36:58.551210 [debug] [MainThread]: Command end result
[0m01:36:58.563377 [info ] [MainThread]: 
[0m01:36:58.564012 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:36:58.564494 [info ] [MainThread]: 
[0m01:36:58.565046 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:36:58.591497 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.409301, "process_user_time": 2.014079, "process_kernel_time": 0.40674, "process_mem_max_rss": "122683392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:36:58.592140 [debug] [MainThread]: Command `dbt run` succeeded at 01:36:58.592014 after 2.41 seconds
[0m01:36:58.592687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048463b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dbecb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b2bf10>]}
[0m01:36:58.593102 [debug] [MainThread]: Flushing usage events
[0m01:38:00.794665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d7be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11126db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11126db10>]}


============================== 01:38:00.797847 | c26382d9-744e-4193-b4c6-944a1c5313da ==============================
[0m01:38:00.797847 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:38:00.798249 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:38:01.405167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115a0040>]}
[0m01:38:01.458144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b0ceb0>]}
[0m01:38:01.466774 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:38:01.517388 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:38:01.878833 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:38:01.879584 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:38:01.886575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cf00d0>]}
[0m01:38:01.910421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cae140>]}
[0m01:38:01.911284 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:38:01.911765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cae470>]}
[0m01:38:01.913427 [info ] [MainThread]: 
[0m01:38:01.914197 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:38:01.915446 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:38:01.961360 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:38:01.961725 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:38:01.961943 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:38:02.184664 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:38:02.187920 [debug] [ThreadPool]: On list_datamart: Close
[0m01:38:02.190773 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:38:02.199942 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:38:02.200462 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:38:02.200893 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:38:02.223244 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:38:02.223700 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:38:02.224148 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:38:02.247787 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m01:38:02.250290 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:38:02.251474 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:38:02.258798 [debug] [MainThread]: Using postgres connection "master"
[0m01:38:02.259330 [debug] [MainThread]: On master: BEGIN
[0m01:38:02.259734 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:38:02.280921 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:38:02.281555 [debug] [MainThread]: Using postgres connection "master"
[0m01:38:02.282131 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:38:02.320126 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:38:02.321817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d376d0>]}
[0m01:38:02.322528 [debug] [MainThread]: On master: ROLLBACK
[0m01:38:02.323411 [debug] [MainThread]: Using postgres connection "master"
[0m01:38:02.323845 [debug] [MainThread]: On master: BEGIN
[0m01:38:02.324676 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:38:02.325176 [debug] [MainThread]: On master: COMMIT
[0m01:38:02.325625 [debug] [MainThread]: Using postgres connection "master"
[0m01:38:02.326032 [debug] [MainThread]: On master: COMMIT
[0m01:38:02.326739 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:38:02.327228 [debug] [MainThread]: On master: Close
[0m01:38:02.328255 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:38:02.328957 [info ] [MainThread]: 
[0m01:38:02.338479 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:38:02.339391 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:38:02.340504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:38:02.341205 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:38:02.353921 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:38:02.369574 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:38:02.341605 => 01:38:02.369192
[0m01:38:02.370191 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:38:02.412979 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:38:02.413997 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:38:02.414332 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:38:02.414588 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:38:02.621003 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:38:02.622287 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:38:02.623073 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
  
    

  create  table "datamart"."datamart"."points_balance_report"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:38:02.654975 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:38:02.684943 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:38:02.685782 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:38:02.686472 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:38:02.689278 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:38:02.690617 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:38:02.370512 => 01:38:02.690357
[0m01:38:02.691096 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:38:02.692003 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c26382d9-744e-4193-b4c6-944a1c5313da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cad930>]}
[0m01:38:02.692696 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mSELECT 4[0m in 0.35s]
[0m01:38:02.693456 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:38:02.695254 [debug] [MainThread]: Using postgres connection "master"
[0m01:38:02.695740 [debug] [MainThread]: On master: BEGIN
[0m01:38:02.696184 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:38:02.721661 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:38:02.722343 [debug] [MainThread]: On master: COMMIT
[0m01:38:02.722659 [debug] [MainThread]: Using postgres connection "master"
[0m01:38:02.722954 [debug] [MainThread]: On master: COMMIT
[0m01:38:02.724216 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:38:02.724776 [debug] [MainThread]: On master: Close
[0m01:38:02.725628 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:38:02.725916 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:38:02.726238 [info ] [MainThread]: 
[0m01:38:02.726581 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m01:38:02.727174 [debug] [MainThread]: Command end result
[0m01:38:02.735635 [info ] [MainThread]: 
[0m01:38:02.736176 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:38:02.736489 [info ] [MainThread]: 
[0m01:38:02.736780 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:38:02.987685 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.2405913, "process_user_time": 2.01306, "process_kernel_time": 0.393033, "process_mem_max_rss": "121159680", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:38:02.990234 [debug] [MainThread]: Command `dbt run` succeeded at 01:38:02.989828 after 2.24 seconds
[0m01:38:02.991627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d7be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d77fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cacc40>]}
[0m01:38:02.992564 [debug] [MainThread]: Flushing usage events
[0m01:38:59.111727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11057f700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11446dae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11446da80>]}


============================== 01:38:59.115113 | d9903df4-0f89-4fd8-93da-57a720e74638 ==============================
[0m01:38:59.115113 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:38:59.115604 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:38:59.535780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112cf3bb0>]}
[0m01:38:59.589017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d98bb0>]}
[0m01:38:59.604875 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:38:59.780517 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:38:59.970515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:38:59.971082 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:38:59.976634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114f7c0d0>]}
[0m01:38:59.986066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114f3e0b0>]}
[0m01:38:59.986480 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:38:59.986781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114f3e3e0>]}
[0m01:38:59.987755 [info ] [MainThread]: 
[0m01:38:59.988305 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:38:59.989015 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:39:00.027708 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:39:00.028110 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:39:00.028333 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:39:00.291101 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:39:00.295408 [debug] [ThreadPool]: On list_datamart: Close
[0m01:39:00.298912 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:39:00.308150 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:39:00.308743 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:39:00.309171 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:39:00.329523 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:39:00.330023 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:39:00.330478 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:39:00.354967 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:00.357336 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:39:00.358353 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:39:00.366270 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:00.366837 [debug] [MainThread]: On master: BEGIN
[0m01:39:00.367244 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:39:00.393682 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:39:00.394428 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:00.395146 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:39:00.429883 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:39:00.433134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114fc36d0>]}
[0m01:39:00.434263 [debug] [MainThread]: On master: ROLLBACK
[0m01:39:00.435507 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:00.436150 [debug] [MainThread]: On master: BEGIN
[0m01:39:00.437068 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:39:00.437817 [debug] [MainThread]: On master: COMMIT
[0m01:39:00.438546 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:00.439128 [debug] [MainThread]: On master: COMMIT
[0m01:39:00.439909 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:39:00.440362 [debug] [MainThread]: On master: Close
[0m01:39:00.441364 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:39:00.442173 [info ] [MainThread]: 
[0m01:39:00.446943 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:39:00.447785 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:39:00.448983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:39:00.449787 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:39:00.462158 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:39:00.463952 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:39:00.450195 => 01:39:00.463575
[0m01:39:00.464511 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:39:00.509858 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:00.510296 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp013900490388"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:39:00.510584 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:39:00.566122 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:39:00.571933 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:00.572324 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:39:00.572918 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:39:00.573248 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:00.573567 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp013900490388'
        
      order by ordinal_position

  
[0m01:39:00.634305 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:00.639935 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:00.640469 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:39:00.645932 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:00.653579 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:00.653983 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:39:00.658512 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:00.670485 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:39:00.671471 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:00.671871 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            using "points_balance_report__dbt_tmp013900490388"
            where (
                
                    "points_balance_report__dbt_tmp013900490388".tenant_date, customer_id = "datamart"."datamart"."points_balance_report".tenant_date, customer_id
                    
                
                
            );
        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp013900490388"
    )
  
[0m01:39:00.677788 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column reference "customer_id" is ambiguous
LINE 9: ...balance_report__dbt_tmp013900490388".tenant_date, customer_i...
                                                             ^

[0m01:39:00.678187 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:39:00.679048 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:39:00.464924 => 01:39:00.678849
[0m01:39:00.679401 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:39:00.775747 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column reference "customer_id" is ambiguous
  LINE 9: ...balance_report__dbt_tmp013900490388".tenant_date, customer_i...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:39:00.776424 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9903df4-0f89-4fd8-93da-57a720e74638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11500d330>]}
[0m01:39:00.777161 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.33s]
[0m01:39:00.777921 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:39:00.779755 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:00.780314 [debug] [MainThread]: On master: BEGIN
[0m01:39:00.780730 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:39:00.808496 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:39:00.809060 [debug] [MainThread]: On master: COMMIT
[0m01:39:00.809398 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:00.809711 [debug] [MainThread]: On master: COMMIT
[0m01:39:00.810473 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:39:00.810955 [debug] [MainThread]: On master: Close
[0m01:39:00.811816 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:39:00.812291 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:39:00.812667 [info ] [MainThread]: 
[0m01:39:00.813039 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m01:39:00.813678 [debug] [MainThread]: Command end result
[0m01:39:00.824193 [info ] [MainThread]: 
[0m01:39:00.824822 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:39:00.825204 [info ] [MainThread]: 
[0m01:39:00.825701 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column reference "customer_id" is ambiguous
  LINE 9: ...balance_report__dbt_tmp013900490388".tenant_date, customer_i...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:39:00.826057 [info ] [MainThread]: 
[0m01:39:00.826378 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:39:01.017042 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.9500597, "process_user_time": 2.0151, "process_kernel_time": 0.388013, "process_mem_max_rss": "121454592", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:39:01.019397 [debug] [MainThread]: Command `dbt run` failed at 01:39:01.019064 after 1.95 seconds
[0m01:39:01.020482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11057f700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114fc37c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115020670>]}
[0m01:39:01.021480 [debug] [MainThread]: Flushing usage events
[0m01:39:18.973053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f4fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10556db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10556db10>]}


============================== 01:39:18.992204 | 153a2dbe-0330-4be7-8050-a2605b81de33 ==============================
[0m01:39:18.992204 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:39:18.993210 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:39:19.334576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10592c040>]}
[0m01:39:19.388560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fe5e70>]}
[0m01:39:19.597515 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:39:19.656043 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:39:19.773024 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:39:19.773406 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:39:19.777774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061cc0d0>]}
[0m01:39:19.786426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10618e140>]}
[0m01:39:19.786793 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:39:19.787076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10618e470>]}
[0m01:39:19.787978 [info ] [MainThread]: 
[0m01:39:19.788482 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:39:19.789144 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:39:19.827901 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:39:19.828276 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:39:19.828487 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:39:20.161458 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:39:20.164263 [debug] [ThreadPool]: On list_datamart: Close
[0m01:39:20.167131 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:39:20.176025 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:39:20.176546 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:39:20.176927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:39:20.213506 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:39:20.214144 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:39:20.214632 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:39:20.238192 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:20.240833 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:39:20.242033 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:39:20.250077 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:20.250661 [debug] [MainThread]: On master: BEGIN
[0m01:39:20.251084 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:39:20.279673 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:39:20.280405 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:20.281089 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:39:20.321324 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:39:20.324328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062136d0>]}
[0m01:39:20.325583 [debug] [MainThread]: On master: ROLLBACK
[0m01:39:20.327328 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:20.328117 [debug] [MainThread]: On master: BEGIN
[0m01:39:20.329319 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:39:20.330025 [debug] [MainThread]: On master: COMMIT
[0m01:39:20.330712 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:20.331315 [debug] [MainThread]: On master: COMMIT
[0m01:39:20.332275 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:39:20.332790 [debug] [MainThread]: On master: Close
[0m01:39:20.333954 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:39:20.334550 [info ] [MainThread]: 
[0m01:39:20.339285 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:39:20.340312 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:39:20.341660 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:39:20.342324 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:39:20.354295 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:39:20.356121 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:39:20.342719 => 01:39:20.355739
[0m01:39:20.356699 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:39:20.402889 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:20.403322 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp013920382607"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:39:20.403612 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:39:20.550476 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:39:20.560569 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:20.561226 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:39:20.562358 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:39:20.562961 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:20.563439 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp013920382607'
        
      order by ordinal_position

  
[0m01:39:20.596777 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:20.604465 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:20.605138 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:39:20.610364 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:20.620223 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:20.620855 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:39:20.625186 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:39:20.639130 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:39:20.640486 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:39:20.640921 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            using "points_balance_report__dbt_tmp013920382607"
            where (
                
                    "points_balance_report__dbt_tmp013920382607".tenant_date, customer_id = "datamart"."datamart"."points_balance_report".tenant_date, customer_id
                    
                
                
            );
        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp013920382607"
    )
  
[0m01:39:20.644068 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column reference "customer_id" is ambiguous
LINE 9: ...balance_report__dbt_tmp013920382607".tenant_date, customer_i...
                                                             ^

[0m01:39:20.644449 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:39:20.645247 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:39:20.357007 => 01:39:20.645050
[0m01:39:20.645598 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:39:20.710049 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column reference "customer_id" is ambiguous
  LINE 9: ...balance_report__dbt_tmp013920382607".tenant_date, customer_i...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:39:20.710673 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '153a2dbe-0330-4be7-8050-a2605b81de33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10625d3c0>]}
[0m01:39:20.711416 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.37s]
[0m01:39:20.712178 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:39:20.713875 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:20.714342 [debug] [MainThread]: On master: BEGIN
[0m01:39:20.714874 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:39:20.745293 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:39:20.746008 [debug] [MainThread]: On master: COMMIT
[0m01:39:20.746408 [debug] [MainThread]: Using postgres connection "master"
[0m01:39:20.746720 [debug] [MainThread]: On master: COMMIT
[0m01:39:20.747554 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:39:20.747977 [debug] [MainThread]: On master: Close
[0m01:39:20.748699 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:39:20.749066 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:39:20.749419 [info ] [MainThread]: 
[0m01:39:20.749770 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m01:39:20.750391 [debug] [MainThread]: Command end result
[0m01:39:20.863716 [info ] [MainThread]: 
[0m01:39:20.864346 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:39:20.864860 [info ] [MainThread]: 
[0m01:39:20.865395 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column reference "customer_id" is ambiguous
  LINE 9: ...balance_report__dbt_tmp013920382607".tenant_date, customer_i...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:39:20.865806 [info ] [MainThread]: 
[0m01:39:20.866217 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:39:20.868999 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.151419, "process_user_time": 1.982351, "process_kernel_time": 0.409682, "process_mem_max_rss": "121241600", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:39:20.869774 [debug] [MainThread]: Command `dbt run` failed at 01:39:20.869614 after 2.15 seconds
[0m01:39:20.870244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f4fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062137c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106270700>]}
[0m01:39:20.870693 [debug] [MainThread]: Flushing usage events
[0m01:40:53.513921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c23e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106badb70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106badb10>]}


============================== 01:40:53.518452 | b77b27ba-180a-4f44-84b9-e4f6639a43b9 ==============================
[0m01:40:53.518452 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:40:53.518933 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:40:54.930081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107068040>]}
[0m01:40:54.999844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075d1e70>]}
[0m01:40:55.001162 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:40:55.014339 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:40:55.354176 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:40:55.355024 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:40:55.719338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078dcfa0>]}
[0m01:40:55.735800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10777a140>]}
[0m01:40:55.736473 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:40:55.736934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10777a470>]}
[0m01:40:55.738436 [info ] [MainThread]: 
[0m01:40:55.739307 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:40:55.740542 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:40:55.750617 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:40:55.751186 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:40:55.751636 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:40:56.078205 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:40:56.082592 [debug] [ThreadPool]: On list_datamart: Close
[0m01:40:56.085704 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:40:56.094879 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:40:56.095459 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:40:56.095891 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:40:56.125030 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:40:56.125719 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:40:56.126205 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:40:56.154097 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:40:56.156247 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:40:56.157453 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:40:56.164679 [debug] [MainThread]: Using postgres connection "master"
[0m01:40:56.165200 [debug] [MainThread]: On master: BEGIN
[0m01:40:56.165573 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:40:56.228471 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:40:56.229244 [debug] [MainThread]: Using postgres connection "master"
[0m01:40:56.229915 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:40:56.335245 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:40:56.337734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107922d10>]}
[0m01:40:56.338725 [debug] [MainThread]: On master: ROLLBACK
[0m01:40:56.340102 [debug] [MainThread]: Using postgres connection "master"
[0m01:40:56.340725 [debug] [MainThread]: On master: BEGIN
[0m01:40:56.341797 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:40:56.342330 [debug] [MainThread]: On master: COMMIT
[0m01:40:56.342837 [debug] [MainThread]: Using postgres connection "master"
[0m01:40:56.343340 [debug] [MainThread]: On master: COMMIT
[0m01:40:56.344481 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:40:56.345078 [debug] [MainThread]: On master: Close
[0m01:40:56.346442 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:40:56.347030 [info ] [MainThread]: 
[0m01:40:56.355605 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:40:56.356376 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:40:56.357259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:40:56.357761 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:40:56.369277 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:40:56.371615 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:40:56.358084 => 01:40:56.371201
[0m01:40:56.372121 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:40:56.414578 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:40:56.415104 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014056396053"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:40:56.415443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:40:56.681195 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:40:56.696064 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:40:56.696876 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:40:56.698688 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:40:56.699415 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:40:56.699970 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014056396053'
        
      order by ordinal_position

  
[0m01:40:56.761105 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:40:56.771861 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:40:56.772669 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:40:56.780277 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:40:56.790621 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:40:56.791358 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:40:56.797516 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:40:56.813817 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:40:56.815742 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:40:56.816228 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                tenant_date, customer_id) in (
                select (tenant_date, customer_id)
                from "points_balance_report__dbt_tmp014056396053"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014056396053"
    )
  
[0m01:40:56.820131 [debug] [Thread-1 (]: Postgres adapter: Postgres error: subquery has too few columns
LINE 7:                 tenant_date, customer_id) in (
                                                  ^

[0m01:40:56.820547 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:40:56.821588 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:40:56.372383 => 01:40:56.821342
[0m01:40:56.821989 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:40:56.840807 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  subquery has too few columns
  LINE 7:                 tenant_date, customer_id) in (
                                                    ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:40:56.841433 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b77b27ba-180a-4f44-84b9-e4f6639a43b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077f8c10>]}
[0m01:40:56.842106 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.48s]
[0m01:40:56.842953 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:40:56.844528 [debug] [MainThread]: Using postgres connection "master"
[0m01:40:56.844922 [debug] [MainThread]: On master: BEGIN
[0m01:40:56.845226 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:40:56.865172 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:40:56.865650 [debug] [MainThread]: On master: COMMIT
[0m01:40:56.865937 [debug] [MainThread]: Using postgres connection "master"
[0m01:40:56.866197 [debug] [MainThread]: On master: COMMIT
[0m01:40:56.867482 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:40:56.867748 [debug] [MainThread]: On master: Close
[0m01:40:56.868275 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:40:56.868532 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:40:56.868810 [info ] [MainThread]: 
[0m01:40:56.869101 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.13 seconds (1.13s).
[0m01:40:56.869607 [debug] [MainThread]: Command end result
[0m01:40:56.964054 [info ] [MainThread]: 
[0m01:40:56.964611 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:40:56.965044 [info ] [MainThread]: 
[0m01:40:56.965549 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  subquery has too few columns
  LINE 7:                 tenant_date, customer_id) in (
                                                    ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:40:56.965925 [info ] [MainThread]: 
[0m01:40:56.966281 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:40:56.968718 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.5413182, "process_user_time": 2.223141, "process_kernel_time": 0.422638, "process_mem_max_rss": "123650048", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:40:56.969322 [debug] [MainThread]: Command `dbt run` failed at 01:40:56.969200 after 3.54 seconds
[0m01:40:56.969702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c23e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10789c1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10776b7f0>]}
[0m01:40:56.970054 [debug] [MainThread]: Flushing usage events
[0m01:42:06.600117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11087fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e6db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e6db10>]}


============================== 01:42:06.605342 | 57d7fc40-e3a5-4d81-84c2-7827bb27953e ==============================
[0m01:42:06.605342 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:42:06.605880 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:42:07.282163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114280040>]}
[0m01:42:07.347146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147e9e70>]}
[0m01:42:07.416755 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:42:07.558177 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:42:07.945933 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:42:07.946926 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:42:07.956888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149d00d0>]}
[0m01:42:07.984254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114992140>]}
[0m01:42:07.985136 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:42:07.985849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114992470>]}
[0m01:42:07.987659 [info ] [MainThread]: 
[0m01:42:07.988658 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:42:07.989962 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:42:08.039034 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:42:08.039403 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:42:08.039691 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:11.349009 [debug] [ThreadPool]: SQL status: SELECT 9 in 3.0 seconds
[0m01:42:11.351450 [debug] [ThreadPool]: On list_datamart: Close
[0m01:42:11.353703 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:42:11.361987 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:42:11.362562 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:42:11.362990 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:42:11.520279 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:42:11.522780 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:42:11.523228 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:42:12.051093 [debug] [ThreadPool]: SQL status: SELECT 2 in 1.0 seconds
[0m01:42:12.054138 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:42:12.056295 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:42:12.064075 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:12.064696 [debug] [MainThread]: On master: BEGIN
[0m01:42:12.065128 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:42:12.646530 [debug] [MainThread]: SQL status: BEGIN in 1.0 seconds
[0m01:42:12.648248 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:12.649127 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:42:12.791219 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:42:12.793945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a176d0>]}
[0m01:42:12.794926 [debug] [MainThread]: On master: ROLLBACK
[0m01:42:12.796301 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:12.796814 [debug] [MainThread]: On master: BEGIN
[0m01:42:12.797946 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:42:12.798567 [debug] [MainThread]: On master: COMMIT
[0m01:42:12.799096 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:12.799574 [debug] [MainThread]: On master: COMMIT
[0m01:42:12.800441 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:42:12.800986 [debug] [MainThread]: On master: Close
[0m01:42:12.802078 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:42:12.802634 [info ] [MainThread]: 
[0m01:42:12.806920 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:42:12.807818 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:42:12.808991 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:42:12.809644 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:42:12.821154 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:42:12.823203 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:42:12.809998 => 01:42:12.822807
[0m01:42:12.823771 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:42:12.867515 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:42:12.868894 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:12.869203 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:42:12.869472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:42:12.885314 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:42:12.885673 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:12.885991 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
  
    

  create  table "datamart"."datamart"."points_balance_report"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:42:12.954552 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:42:12.970050 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:42:12.970444 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:12.970753 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:42:12.972207 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:42:12.973103 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:42:12.824028 => 01:42:12.972921
[0m01:42:12.973443 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:42:12.974062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57d7fc40-e3a5-4d81-84c2-7827bb27953e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114990b20>]}
[0m01:42:12.974547 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mSELECT 4[0m in 0.17s]
[0m01:42:12.974978 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:42:12.976054 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:12.976352 [debug] [MainThread]: On master: BEGIN
[0m01:42:12.976594 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:42:13.092352 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:42:13.092918 [debug] [MainThread]: On master: COMMIT
[0m01:42:13.093382 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:13.093734 [debug] [MainThread]: On master: COMMIT
[0m01:42:13.094683 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:42:13.095193 [debug] [MainThread]: On master: Close
[0m01:42:13.095885 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:42:13.096200 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:42:13.096541 [info ] [MainThread]: 
[0m01:42:13.096901 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 5.11 seconds (5.11s).
[0m01:42:13.097533 [debug] [MainThread]: Command end result
[0m01:42:13.117578 [info ] [MainThread]: 
[0m01:42:13.118182 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:42:13.118549 [info ] [MainThread]: 
[0m01:42:13.118873 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:42:13.123173 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.670626, "process_user_time": 2.115253, "process_kernel_time": 0.435775, "process_mem_max_rss": "121520128", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:42:13.123843 [debug] [MainThread]: Command `dbt run` succeeded at 01:42:13.123689 after 6.67 seconds
[0m01:42:13.124242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11087fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a57fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114990c40>]}
[0m01:42:13.124597 [debug] [MainThread]: Flushing usage events
[0m01:42:24.995573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10496f700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10756da50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10756d9f0>]}


============================== 01:42:25.001592 | 8c974c05-a620-4670-95d5-010334aeadf7 ==============================
[0m01:42:25.001592 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:42:25.002224 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:42:25.571029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10756d900>]}
[0m01:42:25.634737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e99330>]}
[0m01:42:25.638256 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:42:25.654839 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:42:26.007993 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:42:26.008633 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:42:26.015047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102cc0d0>]}
[0m01:42:26.129553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11028e0e0>]}
[0m01:42:26.130491 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:42:26.131019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11028e350>]}
[0m01:42:26.132907 [info ] [MainThread]: 
[0m01:42:26.133964 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:42:26.135424 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:42:26.185853 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:42:26.186243 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:42:26.186489 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:26.257876 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:42:26.258915 [debug] [ThreadPool]: On list_datamart: Close
[0m01:42:26.260001 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:42:26.264195 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:42:26.264523 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:42:26.264743 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:42:26.473453 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:42:26.474238 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:42:26.474809 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:42:26.501836 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:42:26.505704 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:42:26.507964 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:42:26.517033 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:26.517720 [debug] [MainThread]: On master: BEGIN
[0m01:42:26.518206 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:42:26.551049 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:42:26.551795 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:26.552474 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:42:26.594650 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:42:26.599468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103136d0>]}
[0m01:42:26.600599 [debug] [MainThread]: On master: ROLLBACK
[0m01:42:26.601831 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:26.602721 [debug] [MainThread]: On master: BEGIN
[0m01:42:26.603950 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:42:26.604608 [debug] [MainThread]: On master: COMMIT
[0m01:42:26.605151 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:26.605656 [debug] [MainThread]: On master: COMMIT
[0m01:42:26.606572 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:42:26.607193 [debug] [MainThread]: On master: Close
[0m01:42:26.608318 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:42:26.609019 [info ] [MainThread]: 
[0m01:42:26.613677 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:42:26.614630 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:42:26.615841 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:42:26.616604 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:42:26.628554 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:42:26.631136 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:42:26.617007 => 01:42:26.630746
[0m01:42:26.631750 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:42:26.676916 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:26.677356 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014226656911"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:42:26.677643 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:42:26.927282 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:42:26.941364 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:26.942095 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:42:26.943531 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:42:26.944200 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:26.944770 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014226656911'
        
      order by ordinal_position

  
[0m01:42:26.983575 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:42:26.992021 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:26.992728 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:42:27.000786 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:42:27.010607 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:27.011242 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:42:27.020851 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:42:27.035076 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:42:27.036429 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:42:27.036958 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                tenant_date, customer_id) in (
                select (tenant_date, customer_id)
                from "points_balance_report__dbt_tmp014226656911"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014226656911"
    )
  
[0m01:42:27.040772 [debug] [Thread-1 (]: Postgres adapter: Postgres error: subquery has too few columns
LINE 7:                 tenant_date, customer_id) in (
                                                  ^

[0m01:42:27.041197 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:42:27.042087 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:42:26.632067 => 01:42:27.041862
[0m01:42:27.042531 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:42:27.074464 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  subquery has too few columns
  LINE 7:                 tenant_date, customer_id) in (
                                                    ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:42:27.075139 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c974c05-a620-4670-95d5-010334aeadf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110361210>]}
[0m01:42:27.075830 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.46s]
[0m01:42:27.076519 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:42:27.078256 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:27.078715 [debug] [MainThread]: On master: BEGIN
[0m01:42:27.079094 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:42:27.189131 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:42:27.189808 [debug] [MainThread]: On master: COMMIT
[0m01:42:27.190261 [debug] [MainThread]: Using postgres connection "master"
[0m01:42:27.190679 [debug] [MainThread]: On master: COMMIT
[0m01:42:27.191578 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:42:27.192094 [debug] [MainThread]: On master: Close
[0m01:42:27.192924 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:42:27.193292 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:42:27.193686 [info ] [MainThread]: 
[0m01:42:27.194284 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.06 seconds (1.06s).
[0m01:42:27.195104 [debug] [MainThread]: Command end result
[0m01:42:27.205111 [info ] [MainThread]: 
[0m01:42:27.205598 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:42:27.206009 [info ] [MainThread]: 
[0m01:42:27.206405 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  subquery has too few columns
  LINE 7:                 tenant_date, customer_id) in (
                                                    ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:42:27.206759 [info ] [MainThread]: 
[0m01:42:27.207107 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:42:27.209580 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.4116933, "process_user_time": 2.090658, "process_kernel_time": 0.41003, "process_mem_max_rss": "121503744", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:42:27.210096 [debug] [MainThread]: Command `dbt run` failed at 01:42:27.209984 after 2.41 seconds
[0m01:42:27.210663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10496f700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e99330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110380550>]}
[0m01:42:27.211075 [debug] [MainThread]: Flushing usage events
[0m01:42:58.101271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10802be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a56db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a56db10>]}


============================== 01:42:58.107990 | 211065b8-89c9-4412-b036-4f9c9e382721 ==============================
[0m01:42:58.107990 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:42:58.108566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:42:58.856999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a92c040>]}
[0m01:42:58.936850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afe88e0>]}
[0m01:42:58.938903 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:42:59.168754 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:42:59.359808 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:42:59.360620 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:42:59.479712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3ecfa0>]}
[0m01:42:59.500764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b28e140>]}
[0m01:42:59.501150 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:42:59.501411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b28e470>]}
[0m01:42:59.502230 [info ] [MainThread]: 
[0m01:42:59.502776 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:42:59.503481 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:42:59.510173 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:42:59.510563 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:42:59.510827 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:59.971622 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:42:59.975894 [debug] [ThreadPool]: On list_datamart: Close
[0m01:42:59.978968 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:42:59.988271 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:42:59.988868 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:42:59.989300 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:43:00.018209 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:43:00.018913 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:43:00.019400 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:43:00.054035 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:00.056326 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:43:00.057581 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:43:00.065738 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:00.066344 [debug] [MainThread]: On master: BEGIN
[0m01:43:00.066765 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:43:00.116650 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:00.117443 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:00.118125 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:43:00.159500 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:43:00.164571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b536d10>]}
[0m01:43:00.165683 [debug] [MainThread]: On master: ROLLBACK
[0m01:43:00.166985 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:00.167564 [debug] [MainThread]: On master: BEGIN
[0m01:43:00.168710 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:00.169542 [debug] [MainThread]: On master: COMMIT
[0m01:43:00.170187 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:00.170777 [debug] [MainThread]: On master: COMMIT
[0m01:43:00.171932 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:43:00.172620 [debug] [MainThread]: On master: Close
[0m01:43:00.173742 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:43:00.174328 [info ] [MainThread]: 
[0m01:43:00.178443 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:43:00.179359 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:43:00.180426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:43:00.181047 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:43:00.193767 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:43:00.196359 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:43:00.181419 => 01:43:00.195991
[0m01:43:00.196867 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:43:00.241920 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.242352 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014300222127"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:43:00.242654 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:43:00.455256 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:43:00.469018 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.469749 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:43:00.471435 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:43:00.472041 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.472572 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014300222127'
        
      order by ordinal_position

  
[0m01:43:00.507794 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:00.515716 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.516428 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:43:00.522457 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:00.531975 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.532695 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:43:00.537237 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:00.549623 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:43:00.550609 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.551025 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014300222127"
    )


  
[0m01:43:00.555154 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:43:00.567723 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:43:00.568133 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:00.568448 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:43:00.572755 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:43:00.573541 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:43:00.197130 => 01:43:00.573363
[0m01:43:00.573868 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:43:00.574469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211065b8-89c9-4412-b036-4f9c9e382721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b27fb50>]}
[0m01:43:00.574952 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.39s]
[0m01:43:00.575410 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:43:00.576573 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:00.576887 [debug] [MainThread]: On master: BEGIN
[0m01:43:00.577153 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:43:00.707788 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:00.708430 [debug] [MainThread]: On master: COMMIT
[0m01:43:00.709002 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:00.709449 [debug] [MainThread]: On master: COMMIT
[0m01:43:00.710182 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:43:00.710616 [debug] [MainThread]: On master: Close
[0m01:43:00.711622 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:43:00.712324 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:43:00.712863 [info ] [MainThread]: 
[0m01:43:00.713344 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.21 seconds (1.21s).
[0m01:43:00.714105 [debug] [MainThread]: Command end result
[0m01:43:00.723774 [info ] [MainThread]: 
[0m01:43:00.724284 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:43:00.724641 [info ] [MainThread]: 
[0m01:43:00.725003 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:43:00.727171 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.7141867, "process_user_time": 2.198229, "process_kernel_time": 0.407701, "process_mem_max_rss": "124747776", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:43:00.727953 [debug] [MainThread]: Command `dbt run` succeeded at 01:43:00.727753 after 2.71 seconds
[0m01:43:00.728400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10802be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3afe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b30f520>]}
[0m01:43:00.728794 [debug] [MainThread]: Flushing usage events
[0m01:43:28.279603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071a3e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195a9b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195a9b10>]}


============================== 01:43:28.286790 | b37ee53e-4005-4723-8145-a32f3ff66108 ==============================
[0m01:43:28.286790 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:43:28.287201 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:43:28.993107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119a10040>]}
[0m01:43:29.054970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119ce88e0>]}
[0m01:43:29.108024 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:43:29.320315 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:43:29.538282 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:43:29.539386 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:43:29.669044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11adf0fa0>]}
[0m01:43:29.676651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f8e140>]}
[0m01:43:29.677028 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:43:29.677305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f8e470>]}
[0m01:43:29.678085 [info ] [MainThread]: 
[0m01:43:29.678659 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:43:29.679350 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:43:29.685619 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:43:29.685873 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:43:29.686084 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:43:30.036420 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:43:30.039047 [debug] [ThreadPool]: On list_datamart: Close
[0m01:43:30.041316 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:43:30.049001 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:43:30.049474 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:43:30.049844 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:43:30.114606 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:43:30.115322 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:43:30.115879 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:43:30.139998 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:30.143576 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:43:30.145048 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:43:30.154231 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:30.154934 [debug] [MainThread]: On master: BEGIN
[0m01:43:30.155414 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:43:30.176969 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:30.177642 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:30.178307 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:43:30.217511 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:43:30.219826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ae3ad10>]}
[0m01:43:30.220692 [debug] [MainThread]: On master: ROLLBACK
[0m01:43:30.221801 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:30.222316 [debug] [MainThread]: On master: BEGIN
[0m01:43:30.223267 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:30.223882 [debug] [MainThread]: On master: COMMIT
[0m01:43:30.224405 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:30.224894 [debug] [MainThread]: On master: COMMIT
[0m01:43:30.225751 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:43:30.226307 [debug] [MainThread]: On master: Close
[0m01:43:30.227345 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:43:30.227899 [info ] [MainThread]: 
[0m01:43:30.232077 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:43:30.232886 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:43:30.233910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:43:30.234487 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:43:30.247668 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:43:30.251880 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:43:30.234852 => 01:43:30.251533
[0m01:43:30.252389 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:43:30.296436 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:30.296862 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014330277125"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:43:30.297153 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:43:30.482588 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:43:30.495854 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:30.496601 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:43:30.498169 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:43:30.498867 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:30.499406 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014330277125'
        
      order by ordinal_position

  
[0m01:43:30.530871 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:30.539054 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:30.539701 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:43:30.545645 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:30.555652 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:30.556209 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:43:30.566733 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:30.586036 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:43:30.589073 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:30.589651 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                tenant_date, customer_id) in (
                select (tenant_date, customer_id)
                from "points_balance_report__dbt_tmp014330277125"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014330277125"
    )
  
[0m01:43:30.595410 [debug] [Thread-1 (]: Postgres adapter: Postgres error: subquery has too few columns
LINE 7:                 tenant_date, customer_id) in (
                                                  ^

[0m01:43:30.595835 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:43:30.597747 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:43:30.252636 => 01:43:30.597461
[0m01:43:30.598165 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:43:30.639639 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  subquery has too few columns
  LINE 7:                 tenant_date, customer_id) in (
                                                    ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:43:30.640429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b37ee53e-4005-4723-8145-a32f3ff66108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ad0da50>]}
[0m01:43:30.641195 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.41s]
[0m01:43:30.641860 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:43:30.643759 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:30.644164 [debug] [MainThread]: On master: BEGIN
[0m01:43:30.644498 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:43:30.701688 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:30.702280 [debug] [MainThread]: On master: COMMIT
[0m01:43:30.702638 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:30.702971 [debug] [MainThread]: On master: COMMIT
[0m01:43:30.703686 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:43:30.704099 [debug] [MainThread]: On master: Close
[0m01:43:30.704925 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:43:30.705312 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:43:30.705705 [info ] [MainThread]: 
[0m01:43:30.706109 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m01:43:30.706870 [debug] [MainThread]: Command end result
[0m01:43:30.716856 [info ] [MainThread]: 
[0m01:43:30.717315 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:43:30.717632 [info ] [MainThread]: 
[0m01:43:30.717941 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  subquery has too few columns
  LINE 7:                 tenant_date, customer_id) in (
                                                    ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:43:30.718247 [info ] [MainThread]: 
[0m01:43:30.718564 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:43:30.720593 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.4826646, "process_user_time": 2.159065, "process_kernel_time": 0.445061, "process_mem_max_rss": "123535360", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:43:30.721190 [debug] [MainThread]: Command `dbt run` failed at 01:43:30.721062 after 2.48 seconds
[0m01:43:30.721583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071a3e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119a83e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f7fd90>]}
[0m01:43:30.721952 [debug] [MainThread]: Flushing usage events
[0m01:43:55.771092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058b75e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11106dab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11106da50>]}


============================== 01:43:55.774673 | 5b94a0fd-9eb9-4a7a-a611-378a0df0e765 ==============================
[0m01:43:55.774673 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:43:55.775089 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'send_anonymous_usage_stats': 'True'}
[0m01:43:56.395313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11106d960>]}
[0m01:43:56.450292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ae5bd0>]}
[0m01:43:56.622797 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:43:56.706970 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:43:56.895641 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:43:56.896356 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:43:57.063756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111decee0>]}
[0m01:43:57.079724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c8e080>]}
[0m01:43:57.080158 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:43:57.080456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c8e3b0>]}
[0m01:43:57.081355 [info ] [MainThread]: 
[0m01:43:57.081928 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:43:57.082773 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:43:57.089795 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:43:57.090101 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:43:57.090339 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:43:57.520850 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:43:57.523645 [debug] [ThreadPool]: On list_datamart: Close
[0m01:43:57.526396 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:43:57.535432 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:43:57.536001 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:43:57.536434 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:43:57.580084 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:43:57.580887 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:43:57.581459 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:43:57.618755 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:57.622192 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:43:57.623756 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:43:57.632698 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:57.633379 [debug] [MainThread]: On master: BEGIN
[0m01:43:57.633864 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:43:57.657095 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:57.657794 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:57.658465 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:43:57.700924 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:43:57.703314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e36a70>]}
[0m01:43:57.704229 [debug] [MainThread]: On master: ROLLBACK
[0m01:43:57.705468 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:57.706204 [debug] [MainThread]: On master: BEGIN
[0m01:43:57.707209 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:57.707815 [debug] [MainThread]: On master: COMMIT
[0m01:43:57.708346 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:57.708840 [debug] [MainThread]: On master: COMMIT
[0m01:43:57.709859 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:43:57.710377 [debug] [MainThread]: On master: Close
[0m01:43:57.711451 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:43:57.712017 [info ] [MainThread]: 
[0m01:43:57.716411 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:43:57.717323 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:43:57.718453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:43:57.719058 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:43:57.730926 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:43:57.732380 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:43:57.719397 => 01:43:57.732095
[0m01:43:57.732913 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:43:57.776267 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:57.776694 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014357757145"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:43:57.777152 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:43:58.039332 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:43:58.053658 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:58.054344 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:43:58.055744 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:43:58.056475 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:58.057154 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014357757145'
        
      order by ordinal_position

  
[0m01:43:58.103108 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:58.111567 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:58.112270 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:43:58.118619 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:58.128035 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:58.128748 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:43:58.137218 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:43:58.154845 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:43:58.155937 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:43:58.156369 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            using "points_balance_report__dbt_tmp014357757145"
            where (
                
                    "points_balance_report__dbt_tmp014357757145".tenant_date, customer_id = "datamart"."datamart"."points_balance_report".tenant_date, customer_id
                    
                
                
            );
        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014357757145"
    )
  
[0m01:43:58.160990 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column reference "customer_id" is ambiguous
LINE 9: ...balance_report__dbt_tmp014357757145".tenant_date, customer_i...
                                                             ^

[0m01:43:58.161398 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: ROLLBACK
[0m01:43:58.162242 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:43:57.733317 => 01:43:58.162009
[0m01:43:58.162635 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:43:58.227205 [debug] [Thread-1 (]: Database Error in model points_balance_report (models/points_balance_report.sql)
  column reference "customer_id" is ambiguous
  LINE 9: ...balance_report__dbt_tmp014357757145".tenant_date, customer_i...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:43:58.227905 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b94a0fd-9eb9-4a7a-a611-378a0df0e765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d0fbb0>]}
[0m01:43:58.228603 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model datamart.points_balance_report ..... [[31mERROR[0m in 0.51s]
[0m01:43:58.229292 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:43:58.231039 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:58.231429 [debug] [MainThread]: On master: BEGIN
[0m01:43:58.231777 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:43:58.253255 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:43:58.253778 [debug] [MainThread]: On master: COMMIT
[0m01:43:58.254117 [debug] [MainThread]: Using postgres connection "master"
[0m01:43:58.254432 [debug] [MainThread]: On master: COMMIT
[0m01:43:58.255055 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:43:58.255447 [debug] [MainThread]: On master: Close
[0m01:43:58.256174 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:43:58.256501 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:43:58.256861 [info ] [MainThread]: 
[0m01:43:58.257245 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m01:43:58.258251 [debug] [MainThread]: Command end result
[0m01:43:58.312796 [info ] [MainThread]: 
[0m01:43:58.313330 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:43:58.313702 [info ] [MainThread]: 
[0m01:43:58.314052 [error] [MainThread]:   Database Error in model points_balance_report (models/points_balance_report.sql)
  column reference "customer_id" is ambiguous
  LINE 9: ...balance_report__dbt_tmp014357757145".tenant_date, customer_i...
                                                               ^
  compiled Code at target/run/points_balance_report/models/points_balance_report.sql
[0m01:43:58.314390 [info ] [MainThread]: 
[0m01:43:58.314727 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:43:58.319187 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.635518, "process_user_time": 2.189018, "process_kernel_time": 0.438922, "process_mem_max_rss": "125206528", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:43:58.319759 [debug] [MainThread]: Command `dbt run` failed at 01:43:58.319639 after 2.64 seconds
[0m01:43:58.320125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058b75e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ae5bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ea8940>]}
[0m01:43:58.320473 [debug] [MainThread]: Flushing usage events
[0m01:44:23.000503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10417f5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10676db40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10676dae0>]}


============================== 01:44:23.006862 | 41b135d4-88c4-4544-8cba-9940cf7905a9 ==============================
[0m01:44:23.006862 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:44:23.007419 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:44:23.518292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aa0970>]}
[0m01:44:23.592830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10700afb0>]}
[0m01:44:23.605250 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:44:23.645050 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:44:24.022181 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:44:24.022982 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:44:24.387053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107314f70>]}
[0m01:44:24.416617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b2110>]}
[0m01:44:24.417438 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:44:24.418182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b2440>]}
[0m01:44:24.419800 [info ] [MainThread]: 
[0m01:44:24.420696 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:44:24.421962 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:44:24.432983 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:44:24.433524 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:44:24.433865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:44:24.718719 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:44:24.722081 [debug] [ThreadPool]: On list_datamart: Close
[0m01:44:24.725445 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:44:24.734666 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:44:24.735276 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:44:24.736004 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:44:24.803287 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:44:24.804364 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:44:24.805084 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:44:24.836767 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:24.839396 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:44:24.840602 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:44:24.848659 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:24.849205 [debug] [MainThread]: On master: BEGIN
[0m01:44:24.849622 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:44:24.874248 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:44:24.874909 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:24.875571 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:44:24.910563 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:44:24.912431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10753ab30>]}
[0m01:44:24.913126 [debug] [MainThread]: On master: ROLLBACK
[0m01:44:24.914029 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:24.914536 [debug] [MainThread]: On master: BEGIN
[0m01:44:24.915384 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:44:24.915828 [debug] [MainThread]: On master: COMMIT
[0m01:44:24.916241 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:24.916635 [debug] [MainThread]: On master: COMMIT
[0m01:44:24.917519 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:44:24.918108 [debug] [MainThread]: On master: Close
[0m01:44:24.919066 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:44:24.919570 [info ] [MainThread]: 
[0m01:44:24.924006 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:44:24.924770 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:44:24.925711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:44:24.926264 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:44:24.937858 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:44:24.948738 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:44:24.926584 => 01:44:24.948414
[0m01:44:24.949181 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:44:24.990561 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:24.990981 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014424972279"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:44:24.991261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:44:25.241139 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:44:25.255305 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:25.256132 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:44:25.257603 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:44:25.258278 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:25.258822 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014424972279'
        
      order by ordinal_position

  
[0m01:44:25.297425 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:25.306426 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:25.307223 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:44:25.312415 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:25.322242 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:25.322863 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:44:25.327336 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:25.345392 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:44:25.346497 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:25.346995 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                ('tenant_date, customer_id')) in (
                select (('tenant_date, customer_id'))
                from "points_balance_report__dbt_tmp014424972279"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014424972279"
    )
  
[0m01:44:25.355468 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:44:25.367513 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:44:25.367913 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:25.368231 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:44:25.370684 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:44:25.371615 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:44:24.949406 => 01:44:25.371388
[0m01:44:25.371976 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:44:25.372607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41b135d4-88c4-4544-8cba-9940cf7905a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107231180>]}
[0m01:44:25.373100 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.45s]
[0m01:44:25.373562 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:44:25.374716 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:25.375020 [debug] [MainThread]: On master: BEGIN
[0m01:44:25.375278 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:44:25.594944 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:44:25.595906 [debug] [MainThread]: On master: COMMIT
[0m01:44:25.596455 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:25.596891 [debug] [MainThread]: On master: COMMIT
[0m01:44:25.597734 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:44:25.598293 [debug] [MainThread]: On master: Close
[0m01:44:25.599469 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:44:25.600049 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:44:25.600557 [info ] [MainThread]: 
[0m01:44:25.601055 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m01:44:25.601932 [debug] [MainThread]: Command end result
[0m01:44:25.612260 [info ] [MainThread]: 
[0m01:44:25.612849 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:44:25.613250 [info ] [MainThread]: 
[0m01:44:25.613656 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:44:25.630163 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.820341, "process_user_time": 2.223299, "process_kernel_time": 0.416979, "process_mem_max_rss": "123584512", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:44:25.631270 [debug] [MainThread]: Command `dbt run` succeeded at 01:44:25.631069 after 2.82 seconds
[0m01:44:25.631736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10417f5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a4e0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072d3610>]}
[0m01:44:25.632132 [debug] [MainThread]: Flushing usage events
[0m01:44:47.166655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106083640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a86da20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a86d9c0>]}


============================== 01:44:47.170817 | 3c4fdac2-710b-40d6-aa85-1386dae53de9 ==============================
[0m01:44:47.170817 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:44:47.171370 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:44:47.858234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a86d8d0>]}
[0m01:44:47.955970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3c220>]}
[0m01:44:47.971945 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:44:48.060858 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:44:48.197958 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:44:48.198446 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:44:48.204137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b37c0d0>]}
[0m01:44:48.244666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b33dff0>]}
[0m01:44:48.245288 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:44:48.245739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b33e320>]}
[0m01:44:48.247159 [info ] [MainThread]: 
[0m01:44:48.247983 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:44:48.249073 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:44:48.289565 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:44:48.289931 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:44:48.290164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:44:48.751083 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:44:48.755336 [debug] [ThreadPool]: On list_datamart: Close
[0m01:44:48.760887 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:44:48.777263 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:44:48.778153 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:44:48.778774 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:44:48.804278 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:44:48.805414 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:44:48.806139 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:44:48.832790 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:48.836717 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:44:48.838982 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:44:48.853615 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:48.855004 [debug] [MainThread]: On master: BEGIN
[0m01:44:48.855695 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:44:48.879014 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:44:48.880166 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:48.880946 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:44:48.919865 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:44:48.922822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b3c36d0>]}
[0m01:44:48.924980 [debug] [MainThread]: On master: ROLLBACK
[0m01:44:48.926252 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:48.927780 [debug] [MainThread]: On master: BEGIN
[0m01:44:48.928894 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:44:48.929560 [debug] [MainThread]: On master: COMMIT
[0m01:44:48.930202 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:48.930773 [debug] [MainThread]: On master: COMMIT
[0m01:44:48.931803 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:44:48.932443 [debug] [MainThread]: On master: Close
[0m01:44:48.933930 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:44:48.934729 [info ] [MainThread]: 
[0m01:44:48.944123 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:44:48.945788 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:44:48.947284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:44:48.948374 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:44:48.967702 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:44:48.970110 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:44:48.948868 => 01:44:48.969599
[0m01:44:48.970937 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:44:49.031312 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.031749 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014449008224"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:44:49.032061 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:44:49.070034 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:44:49.075806 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.076208 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:44:49.076985 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:44:49.077369 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.077702 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014449008224'
        
      order by ordinal_position

  
[0m01:44:49.105530 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:49.110317 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.110795 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:44:49.114226 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:49.120972 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.121462 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:44:49.124688 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:44:49.138694 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:44:49.139575 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.139931 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                ('tenant_date, customer_id')) in (
                select (('tenant_date, customer_id'))
                from "points_balance_report__dbt_tmp014449008224"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014449008224"
    )
  
[0m01:44:49.142633 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:44:49.153859 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:44:49.154219 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:44:49.154500 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:44:49.155429 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:44:49.156143 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:44:48.971411 => 01:44:49.155976
[0m01:44:49.156444 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:44:49.156987 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c4fdac2-710b-40d6-aa85-1386dae53de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b3ab370>]}
[0m01:44:49.157485 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.21s]
[0m01:44:49.157953 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:44:49.158997 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:49.159275 [debug] [MainThread]: On master: BEGIN
[0m01:44:49.159513 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:44:49.276204 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:44:49.276984 [debug] [MainThread]: On master: COMMIT
[0m01:44:49.277514 [debug] [MainThread]: Using postgres connection "master"
[0m01:44:49.278011 [debug] [MainThread]: On master: COMMIT
[0m01:44:49.278776 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:44:49.279406 [debug] [MainThread]: On master: Close
[0m01:44:49.280465 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:44:49.280971 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:44:49.281541 [info ] [MainThread]: 
[0m01:44:49.282138 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m01:44:49.283133 [debug] [MainThread]: Command end result
[0m01:44:49.295403 [info ] [MainThread]: 
[0m01:44:49.296260 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:44:49.296742 [info ] [MainThread]: 
[0m01:44:49.297213 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:44:49.300506 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1977155, "process_user_time": 2.277559, "process_kernel_time": 0.455083, "process_mem_max_rss": "123518976", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:44:49.301315 [debug] [MainThread]: Command `dbt run` succeeded at 01:44:49.301156 after 2.20 seconds
[0m01:44:49.301814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106083640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b3c37c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b42c640>]}
[0m01:44:49.302299 [debug] [MainThread]: Flushing usage events
[0m01:46:16.495918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111ab610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e6db10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e6dab0>]}


============================== 01:46:16.499543 | dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f ==============================
[0m01:46:16.499543 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:46:16.499942 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-11-30') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:46:17.025926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ff3be0>]}
[0m01:46:17.080002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148944c0>]}
[0m01:46:17.229534 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:46:17.253794 [debug] [MainThread]: checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, vars: {'tenant_date': "DATE('2023-11-30')"}, profile: , target: , version: 1.7.7
[0m01:46:17.263259 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:46:17.263692 [debug] [MainThread]: previous checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, current checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e
[0m01:46:17.263990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147e9690>]}
[0m01:46:18.331735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d2f0a0>]}
[0m01:46:18.392155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d2f100>]}
[0m01:46:18.392707 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:46:18.393186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114897bb0>]}
[0m01:46:18.394300 [info ] [MainThread]: 
[0m01:46:18.394949 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:46:18.395880 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:46:18.404126 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:46:18.404488 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:46:18.404760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:46:19.554160 [debug] [ThreadPool]: SQL status: SELECT 9 in 1.0 seconds
[0m01:46:19.556901 [debug] [ThreadPool]: On list_datamart: Close
[0m01:46:19.559563 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:46:19.567945 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:46:19.568458 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:46:19.568836 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:19.608376 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:46:19.609217 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:46:19.609835 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:46:19.636915 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:46:19.639281 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:46:19.641004 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:46:19.648676 [debug] [MainThread]: Using postgres connection "master"
[0m01:46:19.649173 [debug] [MainThread]: On master: BEGIN
[0m01:46:19.649546 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:46:19.685713 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:46:19.686424 [debug] [MainThread]: Using postgres connection "master"
[0m01:46:19.686997 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:46:19.730297 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:46:19.732562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e437c0>]}
[0m01:46:19.733475 [debug] [MainThread]: On master: ROLLBACK
[0m01:46:19.734664 [debug] [MainThread]: Using postgres connection "master"
[0m01:46:19.735299 [debug] [MainThread]: On master: BEGIN
[0m01:46:19.736345 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:46:19.736952 [debug] [MainThread]: On master: COMMIT
[0m01:46:19.737485 [debug] [MainThread]: Using postgres connection "master"
[0m01:46:19.737974 [debug] [MainThread]: On master: COMMIT
[0m01:46:19.738849 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:46:19.739487 [debug] [MainThread]: On master: Close
[0m01:46:19.740603 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:46:19.741242 [info ] [MainThread]: 
[0m01:46:19.746492 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:46:19.747275 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:46:19.748265 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:46:19.748800 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:46:19.759137 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:46:19.760620 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:46:19.749130 => 01:46:19.760349
[0m01:46:19.761054 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:46:19.803860 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:19.804302 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp014619785362"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-11-30') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-11-30')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-11-30') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-11-30')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:46:19.804592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:19.919421 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:46:19.925644 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:19.926049 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:46:19.926824 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:46:19.927316 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:19.927661 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp014619785362'
        
      order by ordinal_position

  
[0m01:46:20.085693 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:46:20.092770 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:20.093351 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:46:20.102133 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:46:20.111289 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:20.111758 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:46:20.117313 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:46:20.131837 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:46:20.143351 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:20.143833 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                ('tenant_date, customer_id')) in (
                select (('tenant_date, customer_id'))
                from "points_balance_report__dbt_tmp014619785362"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp014619785362"
    )
  
[0m01:46:20.150643 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:46:20.162709 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:46:20.163114 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:46:20.163420 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:46:20.170079 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:46:20.170944 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:46:19.761302 => 01:46:20.170769
[0m01:46:20.171287 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:46:20.171899 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd962e8e-dbc0-4a28-ac3c-20bfe95cd24f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e232b0>]}
[0m01:46:20.172379 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.42s]
[0m01:46:20.172938 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:46:20.174216 [debug] [MainThread]: Using postgres connection "master"
[0m01:46:20.174618 [debug] [MainThread]: On master: BEGIN
[0m01:46:20.174888 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:46:20.401703 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:46:20.402681 [debug] [MainThread]: On master: COMMIT
[0m01:46:20.403322 [debug] [MainThread]: Using postgres connection "master"
[0m01:46:20.403911 [debug] [MainThread]: On master: COMMIT
[0m01:46:20.405124 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:46:20.406084 [debug] [MainThread]: On master: Close
[0m01:46:20.407521 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:46:20.408129 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:46:20.408791 [info ] [MainThread]: 
[0m01:46:20.409459 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.01 seconds (2.01s).
[0m01:46:20.410628 [debug] [MainThread]: Command end result
[0m01:46:20.428536 [info ] [MainThread]: 
[0m01:46:20.429209 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:46:20.429748 [info ] [MainThread]: 
[0m01:46:20.430210 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:46:20.438979 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.0078516, "process_user_time": 2.632548, "process_kernel_time": 0.398899, "process_mem_max_rss": "126468096", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:46:20.439910 [debug] [MainThread]: Command `dbt run` succeeded at 01:46:20.439746 after 4.01 seconds
[0m01:46:20.440413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111ab610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146c28c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147718d0>]}
[0m01:46:20.441075 [debug] [MainThread]: Flushing usage events
[0m01:51:26.391624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054835e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10740db40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10740dae0>]}


============================== 01:51:26.395277 | 754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82 ==============================
[0m01:51:26.395277 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:51:26.395674 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-11-30') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:51:26.550636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078c8550>]}
[0m01:51:26.601410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e32fb0>]}
[0m01:51:26.602386 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:51:26.615939 [debug] [MainThread]: checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, vars: {'tenant_date': "DATE('2023-11-30')"}, profile: , target: , version: 1.7.7
[0m01:51:26.677634 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:51:26.678110 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:51:26.787186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10813cf70>]}
[0m01:51:26.794928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fda110>]}
[0m01:51:26.795254 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:51:26.795496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fda440>]}
[0m01:51:26.796239 [info ] [MainThread]: 
[0m01:51:26.796706 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:51:26.797344 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:51:26.803576 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:51:26.803910 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:51:26.804133 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:51:26.934061 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:51:26.935542 [debug] [ThreadPool]: On list_datamart: Close
[0m01:51:26.937026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:51:26.942743 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:51:26.943133 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:51:26.943428 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:51:26.976457 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:51:26.976956 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:51:26.977328 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:51:27.001149 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:51:27.002616 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:51:27.003278 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:51:27.008503 [debug] [MainThread]: Using postgres connection "master"
[0m01:51:27.008889 [debug] [MainThread]: On master: BEGIN
[0m01:51:27.009213 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:51:27.042916 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:51:27.043403 [debug] [MainThread]: Using postgres connection "master"
[0m01:51:27.043876 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:51:27.075934 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:51:27.077668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108186b30>]}
[0m01:51:27.078360 [debug] [MainThread]: On master: ROLLBACK
[0m01:51:27.079189 [debug] [MainThread]: Using postgres connection "master"
[0m01:51:27.079638 [debug] [MainThread]: On master: BEGIN
[0m01:51:27.080359 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:51:27.080778 [debug] [MainThread]: On master: COMMIT
[0m01:51:27.081213 [debug] [MainThread]: Using postgres connection "master"
[0m01:51:27.081622 [debug] [MainThread]: On master: COMMIT
[0m01:51:27.082297 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:51:27.082713 [debug] [MainThread]: On master: Close
[0m01:51:27.083543 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:51:27.083988 [info ] [MainThread]: 
[0m01:51:27.086880 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:51:27.087489 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:51:27.088234 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:51:27.088656 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:51:27.098376 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:51:27.099650 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:51:27.088930 => 01:51:27.099412
[0m01:51:27.100062 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:51:27.141150 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.141549 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp015127123614"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-11-30') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-11-30')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-11-30') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-11-30')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:51:27.141806 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:51:27.178209 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:51:27.183467 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.183826 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:51:27.184444 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:51:27.184726 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.185002 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp015127123614'
        
      order by ordinal_position

  
[0m01:51:27.199842 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:51:27.203573 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.203911 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:51:27.206276 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:51:27.211800 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.212161 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:51:27.214434 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:51:27.226209 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:51:27.227005 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.227296 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp015127123614"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp015127123614"
    )
  
[0m01:51:27.232960 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:51:27.242395 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:51:27.242699 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:51:27.242949 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:51:27.244242 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:51:27.244823 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:51:27.100299 => 01:51:27.244684
[0m01:51:27.245095 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:51:27.245590 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '754f746e-ac5f-4c60-b6cb-a5b7cc8a9c82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108058040>]}
[0m01:51:27.245984 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.16s]
[0m01:51:27.246348 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:51:27.247207 [debug] [MainThread]: Using postgres connection "master"
[0m01:51:27.247460 [debug] [MainThread]: On master: BEGIN
[0m01:51:27.247671 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:51:27.271264 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:51:27.271626 [debug] [MainThread]: On master: COMMIT
[0m01:51:27.271856 [debug] [MainThread]: Using postgres connection "master"
[0m01:51:27.272075 [debug] [MainThread]: On master: COMMIT
[0m01:51:27.272521 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:51:27.272783 [debug] [MainThread]: On master: Close
[0m01:51:27.273242 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:51:27.273461 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:51:27.273705 [info ] [MainThread]: 
[0m01:51:27.273952 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.48 seconds (0.48s).
[0m01:51:27.274404 [debug] [MainThread]: Command end result
[0m01:51:27.280165 [info ] [MainThread]: 
[0m01:51:27.280479 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:51:27.280701 [info ] [MainThread]: 
[0m01:51:27.280932 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:51:27.282739 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.9271208, "process_user_time": 1.613899, "process_kernel_time": 0.251313, "process_mem_max_rss": "120438784", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:51:27.283123 [debug] [MainThread]: Command `dbt run` succeeded at 01:51:27.283037 after 0.93 seconds
[0m01:51:27.283396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054835e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080598d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e32fb0>]}
[0m01:51:27.283668 [debug] [MainThread]: Flushing usage events
[0m01:52:06.621745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497b610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e6db10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e6dab0>]}


============================== 01:52:06.625233 | c986775d-fc21-416c-9093-a853c97b4b8d ==============================
[0m01:52:06.625233 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:52:06.625633 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-31') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:52:06.792614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff3be0>]}
[0m01:52:06.844261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108898b80>]}
[0m01:52:06.845346 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:52:06.859329 [debug] [MainThread]: checksum: 4b077bc8e613321a46434b4dcfbd15dc48e4fb0f9e746fc41576dda48e181c27, vars: {'tenant_date': "DATE('2023-12-31')"}, profile: , target: , version: 1.7.7
[0m01:52:06.866211 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:52:06.866612 [debug] [MainThread]: previous checksum: 4b077bc8e613321a46434b4dcfbd15dc48e4fb0f9e746fc41576dda48e181c27, current checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f
[0m01:52:06.866846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087e47c0>]}
[0m01:52:07.479724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d2f0a0>]}
[0m01:52:07.487586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d2f100>]}
[0m01:52:07.487932 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:52:07.488174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10889bbb0>]}
[0m01:52:07.488916 [info ] [MainThread]: 
[0m01:52:07.489374 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:52:07.489993 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:52:07.496364 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:52:07.496687 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:52:07.496893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:52:07.693638 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:52:07.695597 [debug] [ThreadPool]: On list_datamart: Close
[0m01:52:07.697401 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:52:07.704380 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:52:07.704892 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:52:07.705214 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:52:07.722769 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:52:07.723256 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:52:07.723670 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:52:07.749071 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:52:07.750452 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:52:07.751184 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:52:07.756729 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:07.757193 [debug] [MainThread]: On master: BEGIN
[0m01:52:07.757560 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:52:07.777665 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:52:07.778198 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:07.778699 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:52:07.804616 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:52:07.806247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e437c0>]}
[0m01:52:07.806868 [debug] [MainThread]: On master: ROLLBACK
[0m01:52:07.808167 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:07.808638 [debug] [MainThread]: On master: BEGIN
[0m01:52:07.810210 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:52:07.810624 [debug] [MainThread]: On master: COMMIT
[0m01:52:07.811025 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:07.811417 [debug] [MainThread]: On master: COMMIT
[0m01:52:07.812131 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:52:07.812568 [debug] [MainThread]: On master: Close
[0m01:52:07.813422 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:52:07.813888 [info ] [MainThread]: 
[0m01:52:07.818777 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:52:07.819622 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:52:07.820460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:52:07.820905 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:52:07.830452 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:52:07.839334 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:52:07.821186 => 01:52:07.839010
[0m01:52:07.839826 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:52:07.881832 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.882262 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp015207863235"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-31') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-31')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-31') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-31')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:52:07.882544 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.918966 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:52:07.924344 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.924670 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:52:07.925201 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:52:07.925495 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.925773 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp015207863235'
        
      order by ordinal_position

  
[0m01:52:07.939799 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:52:07.943842 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.944228 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:52:07.946817 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:52:07.953199 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.953580 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:52:07.955963 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:52:07.967298 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:52:07.968614 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.968994 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp015207863235"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp015207863235"
    )
  
[0m01:52:07.975620 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:52:07.986045 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:52:07.986430 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:52:07.986707 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:52:07.988698 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:52:07.989307 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:52:07.840088 => 01:52:07.989169
[0m01:52:07.989562 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:52:07.990037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c986775d-fc21-416c-9093-a853c97b4b8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e232b0>]}
[0m01:52:07.990430 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.17s]
[0m01:52:07.990798 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:52:07.991720 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:07.991974 [debug] [MainThread]: On master: BEGIN
[0m01:52:07.992173 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:52:08.031683 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:52:08.032045 [debug] [MainThread]: On master: COMMIT
[0m01:52:08.032270 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:08.032485 [debug] [MainThread]: On master: COMMIT
[0m01:52:08.032980 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:52:08.033201 [debug] [MainThread]: On master: Close
[0m01:52:08.033663 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:52:08.033876 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:52:08.034110 [info ] [MainThread]: 
[0m01:52:08.034354 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m01:52:08.034786 [debug] [MainThread]: Command end result
[0m01:52:08.045446 [info ] [MainThread]: 
[0m01:52:08.045822 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:52:08.046060 [info ] [MainThread]: 
[0m01:52:08.046305 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:52:08.047730 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.4653562, "process_user_time": 2.085332, "process_kernel_time": 0.243636, "process_mem_max_rss": "122585088", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:52:08.048139 [debug] [MainThread]: Command `dbt run` succeeded at 01:52:08.048052 after 1.47 seconds
[0m01:52:08.048415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497b610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c28c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087718d0>]}
[0m01:52:08.048680 [debug] [MainThread]: Flushing usage events
[0m01:53:33.454471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d7b700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a6dae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a6da80>]}


============================== 01:53:33.457450 | 9bffdcb6-e29d-4964-b7a9-c33bafbd561e ==============================
[0m01:53:33.457450 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:53:33.457834 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-11-30') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:53:33.599348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132f3bb0>]}
[0m01:53:33.650895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115498c40>]}
[0m01:53:33.651907 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:53:33.664426 [debug] [MainThread]: checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, vars: {'tenant_date': "DATE('2023-11-30')"}, profile: , target: , version: 1.7.7
[0m01:53:33.671447 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:53:33.671799 [debug] [MainThread]: previous checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, current checksum: 4b077bc8e613321a46434b4dcfbd15dc48e4fb0f9e746fc41576dda48e181c27
[0m01:53:33.672038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1153ea830>]}
[0m01:53:34.277813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115837070>]}
[0m01:53:34.285336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158370d0>]}
[0m01:53:34.285642 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:53:34.285884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11549bbb0>]}
[0m01:53:34.286630 [info ] [MainThread]: 
[0m01:53:34.287078 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:53:34.287640 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:53:34.293570 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:53:34.293900 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:53:34.294132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:53:34.474482 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:53:34.476225 [debug] [ThreadPool]: On list_datamart: Close
[0m01:53:34.477989 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:53:34.484833 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:53:34.485276 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:53:34.485603 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:53:34.502951 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:53:34.503427 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:53:34.503796 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:53:34.522886 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m01:53:34.524365 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:53:34.525059 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:53:34.530849 [debug] [MainThread]: Using postgres connection "master"
[0m01:53:34.531322 [debug] [MainThread]: On master: BEGIN
[0m01:53:34.531672 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:53:34.556997 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:53:34.557518 [debug] [MainThread]: Using postgres connection "master"
[0m01:53:34.558029 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:53:34.582584 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:53:34.584224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115837a60>]}
[0m01:53:34.584868 [debug] [MainThread]: On master: ROLLBACK
[0m01:53:34.585662 [debug] [MainThread]: Using postgres connection "master"
[0m01:53:34.586091 [debug] [MainThread]: On master: BEGIN
[0m01:53:34.586815 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:53:34.587228 [debug] [MainThread]: On master: COMMIT
[0m01:53:34.587643 [debug] [MainThread]: Using postgres connection "master"
[0m01:53:34.588025 [debug] [MainThread]: On master: COMMIT
[0m01:53:34.588742 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:53:34.589167 [debug] [MainThread]: On master: Close
[0m01:53:34.590022 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:53:34.590485 [info ] [MainThread]: 
[0m01:53:34.594468 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:53:34.595186 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:53:34.595979 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:53:34.596428 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:53:34.605664 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:53:34.606849 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:53:34.596704 => 01:53:34.606593
[0m01:53:34.607277 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:53:34.647046 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:53:34.656671 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:53:34.656977 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:53:34.657223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:53:34.687524 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:53:34.687890 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:53:34.688194 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
  
    

  create  table "datamart"."datamart"."points_balance_report"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-11-30') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-11-30')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-11-30') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-11-30')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:53:34.721465 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:53:34.735622 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:53:34.736009 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:53:34.736293 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:53:34.738278 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:53:34.738990 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:53:34.607515 => 01:53:34.738831
[0m01:53:34.739292 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:53:34.739823 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bffdcb6-e29d-4964-b7a9-c33bafbd561e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158d3040>]}
[0m01:53:34.740255 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mSELECT 4[0m in 0.14s]
[0m01:53:34.740671 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:53:34.741699 [debug] [MainThread]: Using postgres connection "master"
[0m01:53:34.741950 [debug] [MainThread]: On master: BEGIN
[0m01:53:34.742170 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:53:34.759188 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:53:34.759620 [debug] [MainThread]: On master: COMMIT
[0m01:53:34.759871 [debug] [MainThread]: Using postgres connection "master"
[0m01:53:34.760103 [debug] [MainThread]: On master: COMMIT
[0m01:53:34.760694 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:53:34.760929 [debug] [MainThread]: On master: Close
[0m01:53:34.761399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:53:34.761621 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:53:34.761872 [info ] [MainThread]: 
[0m01:53:34.762126 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m01:53:34.762579 [debug] [MainThread]: Command end result
[0m01:53:34.780991 [info ] [MainThread]: 
[0m01:53:34.781344 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:53:34.781566 [info ] [MainThread]: 
[0m01:53:34.781794 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:53:34.790879 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.3778273, "process_user_time": 2.040677, "process_kernel_time": 0.256189, "process_mem_max_rss": "121339904", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:53:34.791409 [debug] [MainThread]: Command `dbt run` succeeded at 01:53:34.791316 after 1.38 seconds
[0m01:53:34.791695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d7b700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114f00460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115498c40>]}
[0m01:53:34.791968 [debug] [MainThread]: Flushing usage events
[0m01:54:24.152819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e3fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11196db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11196db10>]}


============================== 01:54:24.156236 | 809f316b-0d6d-4373-a0da-78d0c0e335ac ==============================
[0m01:54:24.156236 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:54:24.156666 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:54:24.327848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b8c040>]}
[0m01:54:24.380123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ce5e70>]}
[0m01:54:24.381168 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:54:24.395367 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m01:54:24.404032 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:54:24.404398 [debug] [MainThread]: previous checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, current checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f
[0m01:54:24.404627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c3b6d0>]}
[0m01:54:25.024913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11341f100>]}
[0m01:54:25.033276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11341f160>]}
[0m01:54:25.033643 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:54:25.033885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ce7a00>]}
[0m01:54:25.034652 [info ] [MainThread]: 
[0m01:54:25.035117 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:54:25.035725 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:54:25.042066 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:54:25.042376 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:54:25.042576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:54:25.246421 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:54:25.248664 [debug] [ThreadPool]: On list_datamart: Close
[0m01:54:25.250473 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:54:25.257633 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:54:25.258124 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:54:25.258464 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:54:25.278413 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:54:25.278888 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:54:25.279283 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:54:25.312633 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:25.314521 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:54:25.315450 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:54:25.321601 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:25.322108 [debug] [MainThread]: On master: BEGIN
[0m01:54:25.322478 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:54:25.344043 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:54:25.344579 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:25.345070 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:54:25.374727 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:54:25.376290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134db7c0>]}
[0m01:54:25.376916 [debug] [MainThread]: On master: ROLLBACK
[0m01:54:25.377949 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:25.378384 [debug] [MainThread]: On master: BEGIN
[0m01:54:25.379184 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:54:25.379591 [debug] [MainThread]: On master: COMMIT
[0m01:54:25.379993 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:25.380377 [debug] [MainThread]: On master: COMMIT
[0m01:54:25.381138 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:54:25.381638 [debug] [MainThread]: On master: Close
[0m01:54:25.382587 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:54:25.383097 [info ] [MainThread]: 
[0m01:54:25.400654 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:54:25.401363 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:54:25.402284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:54:25.402773 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:54:25.411774 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:54:25.418687 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:54:25.403053 => 01:54:25.418383
[0m01:54:25.419124 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:54:25.461026 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.461443 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp015425442016"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:54:25.461724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:54:25.510405 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:54:25.515972 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.516346 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:54:25.517148 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:54:25.517426 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.517701 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp015425442016'
        
      order by ordinal_position

  
[0m01:54:25.536464 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:25.540727 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.541097 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:54:25.543880 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:25.550377 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.550777 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:54:25.553179 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:25.564701 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:54:25.565770 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.566081 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp015425442016"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp015425442016"
    )
  
[0m01:54:25.578810 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:54:25.589000 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:54:25.589350 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:25.589612 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:54:25.591869 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:54:25.592498 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:54:25.419343 => 01:54:25.592355
[0m01:54:25.592759 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:54:25.593261 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '809f316b-0d6d-4373-a0da-78d0c0e335ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134bb2b0>]}
[0m01:54:25.593654 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.19s]
[0m01:54:25.594034 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:54:25.594973 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:25.595244 [debug] [MainThread]: On master: BEGIN
[0m01:54:25.595467 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:54:25.628420 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:54:25.628809 [debug] [MainThread]: On master: COMMIT
[0m01:54:25.629056 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:25.629304 [debug] [MainThread]: On master: COMMIT
[0m01:54:25.629822 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:54:25.630054 [debug] [MainThread]: On master: Close
[0m01:54:25.630549 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:54:25.630776 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:54:25.631023 [info ] [MainThread]: 
[0m01:54:25.631282 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m01:54:25.631749 [debug] [MainThread]: Command end result
[0m01:54:25.641617 [info ] [MainThread]: 
[0m01:54:25.642019 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:54:25.642281 [info ] [MainThread]: 
[0m01:54:25.642533 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:54:25.645528 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5348177, "process_user_time": 2.100421, "process_kernel_time": 0.260431, "process_mem_max_rss": "121700352", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:54:25.645957 [debug] [MainThread]: Command `dbt run` succeeded at 01:54:25.645859 after 1.54 seconds
[0m01:54:25.646233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e3fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113211300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b8c040>]}
[0m01:54:25.646506 [debug] [MainThread]: Flushing usage events
[0m01:54:50.797944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10741f5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093a9b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093a9ae0>]}


============================== 01:54:50.801233 | fb1d3d52-3d03-4a96-94be-363b73431279 ==============================
[0m01:54:50.801233 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:54:50.801647 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-10-04') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:54:50.958204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109864550>]}
[0m01:54:51.010561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dd2fb0>]}
[0m01:54:51.011542 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:54:51.023419 [debug] [MainThread]: checksum: daf2169c19286d25886a8f06742b23cf741b6b8af8680e0e9102c06a9aa7b517, vars: {'tenant_date': "DATE('2023-10-04')"}, profile: , target: , version: 1.7.7
[0m01:54:51.032240 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:54:51.032649 [debug] [MainThread]: previous checksum: daf2169c19286d25886a8f06742b23cf741b6b8af8680e0e9102c06a9aa7b517, current checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e
[0m01:54:51.032936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098d5f90>]}
[0m01:54:51.653415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a10f0d0>]}
[0m01:54:51.661210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a10f130>]}
[0m01:54:51.661553 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:54:51.661796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dd3bb0>]}
[0m01:54:51.662575 [info ] [MainThread]: 
[0m01:54:51.663047 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:54:51.663657 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:54:51.670033 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:54:51.670352 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:54:51.670561 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:54:51.881080 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:54:51.883312 [debug] [ThreadPool]: On list_datamart: Close
[0m01:54:51.885176 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:54:51.892142 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:54:51.892614 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:54:51.892939 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:54:51.914532 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:54:51.915069 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:54:51.915471 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:54:51.940015 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:51.942039 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:54:51.942898 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:54:51.949000 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:51.949495 [debug] [MainThread]: On master: BEGIN
[0m01:54:51.949852 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:54:51.982448 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:54:51.982999 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:51.983487 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:54:52.033878 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:54:52.035689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a10f220>]}
[0m01:54:52.036317 [debug] [MainThread]: On master: ROLLBACK
[0m01:54:52.037161 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:52.037586 [debug] [MainThread]: On master: BEGIN
[0m01:54:52.038342 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:54:52.038771 [debug] [MainThread]: On master: COMMIT
[0m01:54:52.039175 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:52.039562 [debug] [MainThread]: On master: COMMIT
[0m01:54:52.040276 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:54:52.040768 [debug] [MainThread]: On master: Close
[0m01:54:52.041711 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:54:52.042197 [info ] [MainThread]: 
[0m01:54:52.046036 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:54:52.046732 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:54:52.047593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:54:52.048046 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:54:52.057462 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:54:52.058867 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:54:52.048316 => 01:54:52.058542
[0m01:54:52.059335 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:54:52.101606 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.102022 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp015452083132"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-10-04') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-10-04')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-10-04') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-10-04')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:54:52.102304 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:54:52.142115 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:54:52.147376 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.147699 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:54:52.148295 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:54:52.148638 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.148946 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp015452083132'
        
      order by ordinal_position

  
[0m01:54:52.164791 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:52.168847 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.169189 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:54:52.171638 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:52.178025 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.178421 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:54:52.180802 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:54:52.192393 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:54:52.193244 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.193553 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp015452083132"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp015452083132"
    )
  
[0m01:54:52.201049 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:54:52.210735 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:54:52.211093 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:54:52.211343 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:54:52.215460 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:54:52.216207 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:54:52.059581 => 01:54:52.216056
[0m01:54:52.216500 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:54:52.217041 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb1d3d52-3d03-4a96-94be-363b73431279', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a20b2b0>]}
[0m01:54:52.217437 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.17s]
[0m01:54:52.217826 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:54:52.218695 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:52.218954 [debug] [MainThread]: On master: BEGIN
[0m01:54:52.219170 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:54:52.253614 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:54:52.253988 [debug] [MainThread]: On master: COMMIT
[0m01:54:52.254234 [debug] [MainThread]: Using postgres connection "master"
[0m01:54:52.254468 [debug] [MainThread]: On master: COMMIT
[0m01:54:52.255035 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:54:52.255272 [debug] [MainThread]: On master: Close
[0m01:54:52.255750 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:54:52.255977 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:54:52.256227 [info ] [MainThread]: 
[0m01:54:52.256488 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.59 seconds (0.59s).
[0m01:54:52.256955 [debug] [MainThread]: Command end result
[0m01:54:52.262671 [info ] [MainThread]: 
[0m01:54:52.262986 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:54:52.263218 [info ] [MainThread]: 
[0m01:54:52.263460 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:54:52.265218 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5049646, "process_user_time": 2.091012, "process_kernel_time": 0.243957, "process_mem_max_rss": "121470976", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:54:52.265625 [debug] [MainThread]: Command `dbt run` succeeded at 01:54:52.265537 after 1.51 seconds
[0m01:54:52.265943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10741f5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ea830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d62950>]}
[0m01:54:52.266218 [debug] [MainThread]: Flushing usage events
[0m01:59:42.421697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ee23b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e6dba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e6db40>]}


============================== 01:59:42.424711 | 4c5eac58-0e46-4536-9b4f-ae67088d0ed6 ==============================
[0m01:59:42.424711 [info ] [MainThread]: Running with dbt=1.7.7
[0m01:59:42.425088 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-10-04') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:59:42.560048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10532b4f0>]}
[0m01:59:42.612856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058921d0>]}
[0m01:59:42.615060 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m01:59:42.627731 [debug] [MainThread]: checksum: daf2169c19286d25886a8f06742b23cf741b6b8af8680e0e9102c06a9aa7b517, vars: {'tenant_date': "DATE('2023-10-04')"}, profile: , target: , version: 1.7.7
[0m01:59:42.693819 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:59:42.694411 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m01:59:42.802468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b98fa0>]}
[0m01:59:42.809716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a3a170>]}
[0m01:59:42.810015 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m01:59:42.810264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a3a4a0>]}
[0m01:59:42.810952 [info ] [MainThread]: 
[0m01:59:42.811400 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:59:42.811977 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m01:59:42.817927 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m01:59:42.818248 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m01:59:42.818465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:59:42.911017 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m01:59:42.912318 [debug] [ThreadPool]: On list_datamart: Close
[0m01:59:42.913545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m01:59:42.918388 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:59:42.918793 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m01:59:42.919080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:59:42.944023 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m01:59:42.944372 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m01:59:42.944659 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m01:59:42.974478 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m01:59:42.975593 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m01:59:42.976252 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m01:59:42.980659 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:42.981000 [debug] [MainThread]: On master: BEGIN
[0m01:59:42.981279 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:59:42.994542 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:59:42.995004 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:42.995401 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:59:43.019526 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m01:59:43.020714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a38970>]}
[0m01:59:43.021146 [debug] [MainThread]: On master: ROLLBACK
[0m01:59:43.021817 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:43.022168 [debug] [MainThread]: On master: BEGIN
[0m01:59:43.022799 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:59:43.023099 [debug] [MainThread]: On master: COMMIT
[0m01:59:43.023423 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:43.023708 [debug] [MainThread]: On master: COMMIT
[0m01:59:43.024219 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:59:43.024525 [debug] [MainThread]: On master: Close
[0m01:59:43.025104 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m01:59:43.025432 [info ] [MainThread]: 
[0m01:59:43.027600 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m01:59:43.028102 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m01:59:43.028778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m01:59:43.029188 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m01:59:43.037277 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m01:59:43.039419 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 01:59:43.029420 => 01:59:43.039194
[0m01:59:43.039785 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m01:59:43.078738 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.079178 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp015943060844"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-10-04') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-10-04')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-10-04') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-10-04')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m01:59:43.079616 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:59:43.116956 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m01:59:43.122402 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.122731 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m01:59:43.123261 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m01:59:43.123518 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.123779 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp015943060844'
        
      order by ordinal_position

  
[0m01:59:43.145242 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:59:43.149113 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.149451 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:59:43.151772 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:59:43.157226 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.157570 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m01:59:43.165532 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m01:59:43.177599 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m01:59:43.178516 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.178805 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp015943060844"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp015943060844"
    )
  
[0m01:59:43.187271 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m01:59:43.196940 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:59:43.197267 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m01:59:43.197520 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m01:59:43.199420 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m01:59:43.200023 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 01:59:43.039987 => 01:59:43.199877
[0m01:59:43.200286 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m01:59:43.200782 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4c5eac58-0e46-4536-9b4f-ae67088d0ed6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a2b520>]}
[0m01:59:43.201182 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.17s]
[0m01:59:43.201571 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m01:59:43.202500 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:43.202731 [debug] [MainThread]: On master: BEGIN
[0m01:59:43.202947 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:59:43.250615 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m01:59:43.251015 [debug] [MainThread]: On master: COMMIT
[0m01:59:43.251266 [debug] [MainThread]: Using postgres connection "master"
[0m01:59:43.251495 [debug] [MainThread]: On master: COMMIT
[0m01:59:43.251958 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m01:59:43.252196 [debug] [MainThread]: On master: Close
[0m01:59:43.252670 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:59:43.252900 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m01:59:43.253152 [info ] [MainThread]: 
[0m01:59:43.253418 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m01:59:43.253880 [debug] [MainThread]: Command end result
[0m01:59:43.259753 [info ] [MainThread]: 
[0m01:59:43.260095 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:59:43.260349 [info ] [MainThread]: 
[0m01:59:43.260612 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:59:43.262155 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.88414425, "process_user_time": 1.592181, "process_kernel_time": 0.251369, "process_mem_max_rss": "120586240", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m01:59:43.262580 [debug] [MainThread]: Command `dbt run` succeeded at 01:59:43.262485 after 0.88 seconds
[0m01:59:43.262862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ee23b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105abbb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105893a00>]}
[0m01:59:43.263181 [debug] [MainThread]: Flushing usage events
[0m02:02:02.187232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10490be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106895b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106895b10>]}


============================== 02:02:02.190115 | e2d37d48-0490-4bc5-b1e3-8d3379b21db4 ==============================
[0m02:02:02.190115 [info ] [MainThread]: Running with dbt=1.7.7
[0m02:02:02.190483 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-10-04') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:02:02.336502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d50040>]}
[0m02:02:02.386233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072b9e70>]}
[0m02:02:02.386937 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m02:02:02.400305 [debug] [MainThread]: checksum: daf2169c19286d25886a8f06742b23cf741b6b8af8680e0e9102c06a9aa7b517, vars: {'tenant_date': "DATE('2023-10-04')"}, profile: , target: , version: 1.7.7
[0m02:02:02.449877 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:02:02.450320 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m02:02:02.556227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075c0fa0>]}
[0m02:02:02.563385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107462140>]}
[0m02:02:02.563680 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m02:02:02.563918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107462470>]}
[0m02:02:02.564622 [info ] [MainThread]: 
[0m02:02:02.565062 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:02:02.565633 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m02:02:02.571505 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m02:02:02.571822 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m02:02:02.572028 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:02:02.650276 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m02:02:02.651476 [debug] [ThreadPool]: On list_datamart: Close
[0m02:02:02.652663 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m02:02:02.657328 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:02:02.657612 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m02:02:02.657845 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:02:02.673478 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:02:02.673761 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:02:02.674039 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m02:02:02.696052 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m02:02:02.697070 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m02:02:02.697592 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m02:02:02.701482 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:02.701785 [debug] [MainThread]: On master: BEGIN
[0m02:02:02.702031 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:02:02.720461 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:02.720810 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:02.721184 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:02:02.747229 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m02:02:02.748323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10760ad10>]}
[0m02:02:02.748765 [debug] [MainThread]: On master: ROLLBACK
[0m02:02:02.749363 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:02.749689 [debug] [MainThread]: On master: BEGIN
[0m02:02:02.750316 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:02.750639 [debug] [MainThread]: On master: COMMIT
[0m02:02:02.750946 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:02.751241 [debug] [MainThread]: On master: COMMIT
[0m02:02:02.751785 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:02:02.752104 [debug] [MainThread]: On master: Close
[0m02:02:02.752721 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m02:02:02.753065 [info ] [MainThread]: 
[0m02:02:02.755340 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m02:02:02.755838 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m02:02:02.756474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m02:02:02.756840 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m02:02:02.765160 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m02:02:02.766310 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 02:02:02.757060 => 02:02:02.766072
[0m02:02:02.766695 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m02:02:02.804789 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m02:02:02.805777 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:02.806028 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m02:02:02.806260 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:02:02.831452 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m02:02:02.832377 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:02.832683 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
  
    

  create  table "datamart"."datamart"."points_balance_report"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-10-04') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-10-04')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-10-04') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-10-04')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m02:02:02.860500 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m02:02:02.873748 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:02:02.874072 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:02.874346 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:02:02.875324 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m02:02:02.875979 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 02:02:02.766897 => 02:02:02.875824
[0m02:02:02.876260 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m02:02:02.876795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2d37d48-0490-4bc5-b1e3-8d3379b21db4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e0820>]}
[0m02:02:02.877240 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mSELECT 4[0m in 0.12s]
[0m02:02:02.877666 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m02:02:02.878620 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:02.878864 [debug] [MainThread]: On master: BEGIN
[0m02:02:02.879084 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:02:02.887508 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:02.887833 [debug] [MainThread]: On master: COMMIT
[0m02:02:02.888075 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:02.888302 [debug] [MainThread]: On master: COMMIT
[0m02:02:02.888783 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:02:02.889021 [debug] [MainThread]: On master: Close
[0m02:02:02.889479 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:02:02.889703 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m02:02:02.889956 [info ] [MainThread]: 
[0m02:02:02.890227 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m02:02:02.890699 [debug] [MainThread]: Command end result
[0m02:02:02.935318 [info ] [MainThread]: 
[0m02:02:02.935689 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:02:02.935936 [info ] [MainThread]: 
[0m02:02:02.936189 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:02:02.988868 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8359311, "process_user_time": 1.543175, "process_kernel_time": 0.225624, "process_mem_max_rss": "119685120", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m02:02:02.989474 [debug] [MainThread]: Command `dbt run` succeeded at 02:02:02.989353 after 0.84 seconds
[0m02:02:02.989848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10490be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072b9e70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075781c0>]}
[0m02:02:02.990200 [debug] [MainThread]: Flushing usage events
[0m02:02:23.981126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cd7610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c61b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c61ab0>]}


============================== 02:02:23.984059 | c30b0b08-0938-487e-b737-3a1a5058416f ==============================
[0m02:02:23.984059 [info ] [MainThread]: Running with dbt=1.7.7
[0m02:02:23.984427 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-11-30') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:02:24.122825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fabbe0>]}
[0m02:02:24.172647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107688bb0>]}
[0m02:02:24.173409 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m02:02:24.183937 [debug] [MainThread]: checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, vars: {'tenant_date': "DATE('2023-11-30')"}, profile: , target: , version: 1.7.7
[0m02:02:24.190872 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m02:02:24.191226 [debug] [MainThread]: previous checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f, current checksum: daf2169c19286d25886a8f06742b23cf741b6b8af8680e0e9102c06a9aa7b517
[0m02:02:24.191472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075d47c0>]}
[0m02:02:24.781533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a270a0>]}
[0m02:02:24.788818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a27100>]}
[0m02:02:24.789106 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m02:02:24.789347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10768bbb0>]}
[0m02:02:24.790054 [info ] [MainThread]: 
[0m02:02:24.790498 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:02:24.791064 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m02:02:24.796907 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m02:02:24.797163 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m02:02:24.797358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:02:24.918426 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m02:02:24.919962 [debug] [ThreadPool]: On list_datamart: Close
[0m02:02:24.921345 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m02:02:24.926671 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:02:24.927094 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m02:02:24.927421 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:02:24.946093 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:02:24.946410 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:02:24.946716 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m02:02:24.968443 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:24.969635 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m02:02:24.970285 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m02:02:24.975057 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:24.975430 [debug] [MainThread]: On master: BEGIN
[0m02:02:24.975737 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:02:24.991816 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:24.992215 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:24.992649 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:02:25.019621 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m02:02:25.021102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a26ef0>]}
[0m02:02:25.021696 [debug] [MainThread]: On master: ROLLBACK
[0m02:02:25.022574 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:25.022998 [debug] [MainThread]: On master: BEGIN
[0m02:02:25.023791 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:25.024199 [debug] [MainThread]: On master: COMMIT
[0m02:02:25.024556 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:25.024896 [debug] [MainThread]: On master: COMMIT
[0m02:02:25.025480 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:02:25.025842 [debug] [MainThread]: On master: Close
[0m02:02:25.026580 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m02:02:25.026981 [info ] [MainThread]: 
[0m02:02:25.035095 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m02:02:25.035834 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m02:02:25.036666 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m02:02:25.037125 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m02:02:25.046280 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m02:02:25.049069 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 02:02:25.037411 => 02:02:25.048809
[0m02:02:25.049462 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m02:02:25.090688 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.091103 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp020225072654"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-11-30') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-11-30')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-11-30') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-11-30')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m02:02:25.091385 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:02:25.130543 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m02:02:25.135794 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.136112 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m02:02:25.136624 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m02:02:25.136897 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.137175 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp020225072654'
        
      order by ordinal_position

  
[0m02:02:25.167966 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:25.172024 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.172385 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:02:25.174852 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:25.181483 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.181849 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:02:25.184200 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:25.193962 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m02:02:25.194885 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.195201 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp020225072654"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp020225072654"
    )
  
[0m02:02:25.198242 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m02:02:25.208206 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:02:25.208510 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:25.208769 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:02:25.210400 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m02:02:25.210998 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 02:02:25.049681 => 02:02:25.210856
[0m02:02:25.211265 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m02:02:25.211753 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c30b0b08-0938-487e-b737-3a1a5058416f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ac3280>]}
[0m02:02:25.212143 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.18s]
[0m02:02:25.212520 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m02:02:25.213397 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:25.213624 [debug] [MainThread]: On master: BEGIN
[0m02:02:25.213829 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:02:25.227871 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:25.228206 [debug] [MainThread]: On master: COMMIT
[0m02:02:25.228427 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:25.228641 [debug] [MainThread]: On master: COMMIT
[0m02:02:25.229069 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:02:25.229288 [debug] [MainThread]: On master: Close
[0m02:02:25.229750 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:02:25.229968 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m02:02:25.230218 [info ] [MainThread]: 
[0m02:02:25.230474 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m02:02:25.230941 [debug] [MainThread]: Command end result
[0m02:02:25.236847 [info ] [MainThread]: 
[0m02:02:25.237253 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:02:25.237593 [info ] [MainThread]: 
[0m02:02:25.237838 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:02:25.255834 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.3096615, "process_user_time": 2.016472, "process_kernel_time": 0.229354, "process_mem_max_rss": "120455168", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m02:02:25.256357 [debug] [MainThread]: Command `dbt run` succeeded at 02:02:25.256266 after 1.31 seconds
[0m02:02:25.256638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cd7610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070a28c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071518d0>]}
[0m02:02:25.256906 [debug] [MainThread]: Flushing usage events
[0m02:02:47.441117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10307be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786db70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786db10>]}


============================== 02:02:47.443993 | 64db0dfe-923e-44cd-841d-e7a396ea42ce ==============================
[0m02:02:47.443993 [info ] [MainThread]: Running with dbt=1.7.7
[0m02:02:47.444365 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:02:47.602398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ba0040>]}
[0m02:02:47.656778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cf8820>]}
[0m02:02:47.657536 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m02:02:47.671585 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m02:02:47.679248 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m02:02:47.679607 [debug] [MainThread]: previous checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, current checksum: d59014a236db80c477ed10dfeaf43d1b60be1d75d4f05110df15abf3adf6ed3f
[0m02:02:47.679834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c4f6d0>]}
[0m02:02:48.329263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184d3100>]}
[0m02:02:48.356257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184d3160>]}
[0m02:02:48.356611 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m02:02:48.356894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cfba00>]}
[0m02:02:48.357730 [info ] [MainThread]: 
[0m02:02:48.358232 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:02:48.358876 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m02:02:48.365809 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m02:02:48.366082 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m02:02:48.366302 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:02:48.573889 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m02:02:48.576817 [debug] [ThreadPool]: On list_datamart: Close
[0m02:02:48.579509 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m02:02:48.588693 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:02:48.589206 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m02:02:48.589638 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:02:48.617547 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:02:48.618179 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:02:48.618721 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m02:02:48.646826 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:48.650505 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m02:02:48.652276 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m02:02:48.660777 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:48.661340 [debug] [MainThread]: On master: BEGIN
[0m02:02:48.661820 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:02:48.687756 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:48.688288 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:48.688926 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:02:48.725234 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m02:02:48.729286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1185937c0>]}
[0m02:02:48.730507 [debug] [MainThread]: On master: ROLLBACK
[0m02:02:48.731734 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:48.732181 [debug] [MainThread]: On master: BEGIN
[0m02:02:48.732967 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:48.733389 [debug] [MainThread]: On master: COMMIT
[0m02:02:48.733802 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:48.734185 [debug] [MainThread]: On master: COMMIT
[0m02:02:48.734846 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:02:48.735277 [debug] [MainThread]: On master: Close
[0m02:02:48.736189 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m02:02:48.736671 [info ] [MainThread]: 
[0m02:02:48.741316 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m02:02:48.742120 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m02:02:48.743296 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m02:02:48.744021 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m02:02:48.756005 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m02:02:48.757939 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 02:02:48.744428 => 02:02:48.757472
[0m02:02:48.758559 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m02:02:48.803816 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.804250 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp020248784786"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m02:02:48.804541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:02:48.837310 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m02:02:48.842698 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.843016 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m02:02:48.843530 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m02:02:48.843808 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.844088 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp020248784786'
        
      order by ordinal_position

  
[0m02:02:48.861618 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:48.865537 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.865898 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:02:48.868275 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:48.874662 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.874993 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:02:48.877200 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:02:48.886577 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m02:02:48.888613 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.888927 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp020248784786"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp020248784786"
    )
  
[0m02:02:48.892929 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m02:02:48.902709 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:02:48.903008 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:02:48.903262 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:02:48.904683 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m02:02:48.905316 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 02:02:48.758841 => 02:02:48.905168
[0m02:02:48.905602 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m02:02:48.906103 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64db0dfe-923e-44cd-841d-e7a396ea42ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11856f2b0>]}
[0m02:02:48.906517 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.16s]
[0m02:02:48.906907 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m02:02:48.907951 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:48.908231 [debug] [MainThread]: On master: BEGIN
[0m02:02:48.908453 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:02:48.936541 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:02:48.936956 [debug] [MainThread]: On master: COMMIT
[0m02:02:48.937214 [debug] [MainThread]: Using postgres connection "master"
[0m02:02:48.937440 [debug] [MainThread]: On master: COMMIT
[0m02:02:48.937971 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:02:48.938351 [debug] [MainThread]: On master: Close
[0m02:02:48.938930 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:02:48.939161 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m02:02:48.939400 [info ] [MainThread]: 
[0m02:02:48.939652 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m02:02:48.940084 [debug] [MainThread]: Command end result
[0m02:02:48.945989 [info ] [MainThread]: 
[0m02:02:48.946407 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:02:48.946686 [info ] [MainThread]: 
[0m02:02:48.946946 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:02:48.948796 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5420113, "process_user_time": 2.114315, "process_kernel_time": 0.239309, "process_mem_max_rss": "124108800", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m02:02:48.949239 [debug] [MainThread]: Command `dbt run` succeeded at 02:02:48.949146 after 1.54 seconds
[0m02:02:48.949535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10307be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e6bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ba0040>]}
[0m02:02:48.949858 [debug] [MainThread]: Flushing usage events
[0m02:03:04.674796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11837f760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b96dab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b96da50>]}


============================== 02:03:04.677956 | be0f93cd-5494-4c7f-afad-7493d65e9021 ==============================
[0m02:03:04.677956 [info ] [MainThread]: Running with dbt=1.7.7
[0m02:03:04.678339 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:03:04.815304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b96d960>]}
[0m02:03:04.865153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c298be0>]}
[0m02:03:04.865890 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m02:03:04.876146 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m02:03:04.927744 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:03:04.928074 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:03:04.931723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5cc0d0>]}
[0m02:03:04.939949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c58e140>]}
[0m02:03:04.940258 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m02:03:04.940527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c58e3b0>]}
[0m02:03:04.941305 [info ] [MainThread]: 
[0m02:03:04.941767 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:03:04.942370 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m02:03:04.979969 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m02:03:04.980296 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m02:03:04.980506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:05.072392 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m02:03:05.073808 [debug] [ThreadPool]: On list_datamart: Close
[0m02:03:05.075159 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m02:03:05.079997 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:03:05.080401 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m02:03:05.080708 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:05.097653 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:03:05.097964 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:03:05.098272 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m02:03:05.120428 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:03:05.121714 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m02:03:05.122349 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m02:03:05.126820 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:05.127148 [debug] [MainThread]: On master: BEGIN
[0m02:03:05.127427 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:03:05.143608 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:05.143992 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:05.144412 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:03:05.168460 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m02:03:05.169672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c58c1c0>]}
[0m02:03:05.170170 [debug] [MainThread]: On master: ROLLBACK
[0m02:03:05.170907 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:05.171270 [debug] [MainThread]: On master: BEGIN
[0m02:03:05.171954 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:05.172307 [debug] [MainThread]: On master: COMMIT
[0m02:03:05.172652 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:05.172976 [debug] [MainThread]: On master: COMMIT
[0m02:03:05.173514 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:03:05.173827 [debug] [MainThread]: On master: Close
[0m02:03:05.174448 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m02:03:05.174795 [info ] [MainThread]: 
[0m02:03:05.181818 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m02:03:05.182512 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m02:03:05.183274 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m02:03:05.183672 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m02:03:05.192202 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m02:03:05.193402 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 02:03:05.183920 => 02:03:05.193183
[0m02:03:05.193776 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m02:03:05.236961 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.237373 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp020305218009"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
ORDER BY
  1,2
  );
  
  
[0m02:03:05.237634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:03:05.284279 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m02:03:05.289796 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.290123 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m02:03:05.290628 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m02:03:05.290912 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.291201 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp020305218009'
        
      order by ordinal_position

  
[0m02:03:05.311733 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:03:05.315696 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.316057 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:03:05.318822 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:03:05.324687 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.325033 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:03:05.327428 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:03:05.336797 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m02:03:05.337559 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.337877 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp020305218009"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp020305218009"
    )
  
[0m02:03:05.341029 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m02:03:05.350842 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:03:05.351139 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:03:05.351393 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:03:05.352924 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m02:03:05.353518 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 02:03:05.194005 => 02:03:05.353373
[0m02:03:05.353779 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m02:03:05.354263 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be0f93cd-5494-4c7f-afad-7493d65e9021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5fb310>]}
[0m02:03:05.354650 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.17s]
[0m02:03:05.355027 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m02:03:05.355921 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:05.356185 [debug] [MainThread]: On master: BEGIN
[0m02:03:05.356408 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:03:05.373911 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:03:05.374294 [debug] [MainThread]: On master: COMMIT
[0m02:03:05.374530 [debug] [MainThread]: Using postgres connection "master"
[0m02:03:05.374750 [debug] [MainThread]: On master: COMMIT
[0m02:03:05.375197 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:03:05.375414 [debug] [MainThread]: On master: Close
[0m02:03:05.375851 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:03:05.376051 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m02:03:05.376280 [info ] [MainThread]: 
[0m02:03:05.376516 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.43 seconds (0.43s).
[0m02:03:05.376921 [debug] [MainThread]: Command end result
[0m02:03:05.384652 [info ] [MainThread]: 
[0m02:03:05.385031 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:03:05.385256 [info ] [MainThread]: 
[0m02:03:05.385494 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:03:05.386959 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.7513135, "process_user_time": 1.508354, "process_kernel_time": 0.225735, "process_mem_max_rss": "117981184", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m02:03:05.387339 [debug] [MainThread]: Command `dbt run` succeeded at 02:03:05.387256 after 0.75 seconds
[0m02:03:05.387672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11837f760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5fb310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c77c880>]}
[0m02:03:05.387950 [debug] [MainThread]: Flushing usage events
[0m02:04:37.034339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10306a3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ff5ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ff5b40>]}


============================== 02:04:37.037255 | 57dd680c-ee82-447e-aa36-5d86a4f90d37 ==============================
[0m02:04:37.037255 [info ] [MainThread]: Running with dbt=1.7.7
[0m02:04:37.037643 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-01') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:04:37.173294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054af4f0>]}
[0m02:04:37.222727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a18610>]}
[0m02:04:37.223543 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m02:04:37.237251 [debug] [MainThread]: checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e, vars: {'tenant_date': "DATE('2023-12-01')"}, profile: , target: , version: 1.7.7
[0m02:04:37.290897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:04:37.291385 [debug] [MainThread]: Partial parsing: updated file: points_balance_report://models/points_balance_report.sql
[0m02:04:37.397222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d20fa0>]}
[0m02:04:37.416332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc2170>]}
[0m02:04:37.416646 [info ] [MainThread]: Found 2 seeds, 1 model, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m02:04:37.416893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc24a0>]}
[0m02:04:37.417639 [info ] [MainThread]: 
[0m02:04:37.418097 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m02:04:37.418676 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m02:04:37.424845 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m02:04:37.425111 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m02:04:37.425316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:04:37.494977 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.0 seconds
[0m02:04:37.496212 [debug] [ThreadPool]: On list_datamart: Close
[0m02:04:37.497394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m02:04:37.501754 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:04:37.502042 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m02:04:37.502279 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:04:37.519845 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m02:04:37.520133 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m02:04:37.520410 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m02:04:37.541331 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m02:04:37.542395 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m02:04:37.542980 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m02:04:37.546978 [debug] [MainThread]: Using postgres connection "master"
[0m02:04:37.547280 [debug] [MainThread]: On master: BEGIN
[0m02:04:37.547528 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:04:37.564414 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:04:37.564778 [debug] [MainThread]: Using postgres connection "master"
[0m02:04:37.565155 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m02:04:37.588578 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m02:04:37.589721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d66d40>]}
[0m02:04:37.590180 [debug] [MainThread]: On master: ROLLBACK
[0m02:04:37.590785 [debug] [MainThread]: Using postgres connection "master"
[0m02:04:37.591118 [debug] [MainThread]: On master: BEGIN
[0m02:04:37.591747 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:04:37.592069 [debug] [MainThread]: On master: COMMIT
[0m02:04:37.592378 [debug] [MainThread]: Using postgres connection "master"
[0m02:04:37.592673 [debug] [MainThread]: On master: COMMIT
[0m02:04:37.593210 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:04:37.593528 [debug] [MainThread]: On master: Close
[0m02:04:37.594152 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m02:04:37.594505 [info ] [MainThread]: 
[0m02:04:37.596753 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m02:04:37.597208 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m02:04:37.597779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m02:04:37.598107 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m02:04:37.606148 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m02:04:37.607218 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 02:04:37.598312 => 02:04:37.607018
[0m02:04:37.607576 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m02:04:37.645492 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.645890 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp020437628383"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-01') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-01')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-01') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-01')
GROUP BY
  1,2
  );
  
  
[0m02:04:37.646161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:04:37.682780 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m02:04:37.687815 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.688133 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m02:04:37.688649 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m02:04:37.688926 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.689204 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp020437628383'
        
      order by ordinal_position

  
[0m02:04:37.707029 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:04:37.710806 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.711130 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:04:37.713668 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:04:37.718995 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.719333 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m02:04:37.721667 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m02:04:37.731600 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m02:04:37.732324 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.732611 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp020437628383"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp020437628383"
    )
  
[0m02:04:37.735525 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m02:04:37.744806 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:04:37.745090 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m02:04:37.745365 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m02:04:37.767048 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m02:04:37.767726 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 02:04:37.607778 => 02:04:37.767572
[0m02:04:37.768012 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m02:04:37.768544 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57dd680c-ee82-447e-aa36-5d86a4f90d37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c43d30>]}
[0m02:04:37.768976 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.17s]
[0m02:04:37.769391 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m02:04:37.770305 [debug] [MainThread]: Using postgres connection "master"
[0m02:04:37.770550 [debug] [MainThread]: On master: BEGIN
[0m02:04:37.770773 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:04:37.835678 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m02:04:37.836149 [debug] [MainThread]: On master: COMMIT
[0m02:04:37.836453 [debug] [MainThread]: Using postgres connection "master"
[0m02:04:37.836737 [debug] [MainThread]: On master: COMMIT
[0m02:04:37.837246 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m02:04:37.837536 [debug] [MainThread]: On master: Close
[0m02:04:37.838111 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:04:37.838382 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m02:04:37.838680 [info ] [MainThread]: 
[0m02:04:37.838994 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m02:04:37.839545 [debug] [MainThread]: Command end result
[0m02:04:37.858225 [info ] [MainThread]: 
[0m02:04:37.858676 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:04:37.858958 [info ] [MainThread]: 
[0m02:04:37.859241 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:04:37.863000 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.8639596, "process_user_time": 1.570258, "process_kernel_time": 0.236536, "process_mem_max_rss": "120635392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m02:04:37.863506 [debug] [MainThread]: Command `dbt run` succeeded at 02:04:37.863398 after 0.86 seconds
[0m02:04:37.863851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10306a3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c42f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a18610>]}
[0m02:04:37.864162 [debug] [MainThread]: Flushing usage events
[0m13:43:02.543721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10767a3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b71b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b71ab0>]}


============================== 13:43:02.580662 | dc3466de-bef7-4cdc-893e-3f454414e570 ==============================
[0m13:43:02.580662 [info ] [MainThread]: Running with dbt=1.7.7
[0m13:43:02.581792 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/dimas.adiluhung/points_balance_report/profiles', 'log_path': '/Users/dimas.adiluhung/points_balance_report/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': "dbt run --model points_balance_report --vars tenant_date: DATE('2023-12-1') --profiles-dir /Users/dimas.adiluhung/points_balance_report/profiles", 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:43:04.259301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bf3c70>]}
[0m13:43:04.329746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113498c10>]}
[0m13:43:04.567139 [info ] [MainThread]: Registered adapter: postgres=1.7.7
[0m13:43:04.667686 [debug] [MainThread]: checksum: f344d9c9f1d3a04b878c21c3daecb4d2d9c33fe2ad53529abc85436f6388f06a, vars: {'tenant_date': "DATE('2023-12-1')"}, profile: , target: , version: 1.7.7
[0m13:43:04.678426 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m13:43:04.678926 [debug] [MainThread]: previous checksum: f344d9c9f1d3a04b878c21c3daecb4d2d9c33fe2ad53529abc85436f6388f06a, current checksum: c9dfe93834ace7116d082e318c7be9b57832cc1e4aff865a3596e83f94eb2f5e
[0m13:43:04.679294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133e9690>]}
[0m13:43:07.951617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a870a0>]}
[0m13:43:08.028263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a87100>]}
[0m13:43:08.028799 [info ] [MainThread]: Found 1 model, 2 seeds, 0 sources, 0 exposures, 0 metrics, 401 macros, 0 groups, 0 semantic models
[0m13:43:08.029187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11349bbb0>]}
[0m13:43:08.030393 [info ] [MainThread]: 
[0m13:43:08.031264 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:43:08.032284 [debug] [ThreadPool]: Acquiring new postgres connection 'list_datamart'
[0m13:43:08.041148 [debug] [ThreadPool]: Using postgres connection "list_datamart"
[0m13:43:08.041476 [debug] [ThreadPool]: On list_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart"} */

    select distinct nspname from pg_namespace
  
[0m13:43:08.041740 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:43:08.901734 [debug] [ThreadPool]: SQL status: SELECT 9 in 1.0 seconds
[0m13:43:08.903049 [debug] [ThreadPool]: On list_datamart: Close
[0m13:43:08.904397 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datamart, now list_datamart_datamart)
[0m13:43:08.910027 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m13:43:08.910388 [debug] [ThreadPool]: On list_datamart_datamart: BEGIN
[0m13:43:08.910650 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:43:09.018667 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:43:09.019400 [debug] [ThreadPool]: Using postgres connection "list_datamart_datamart"
[0m13:43:09.019971 [debug] [ThreadPool]: On list_datamart_datamart: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "list_datamart_datamart"} */
select
      'datamart' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'datamart'
    union all
    select
      'datamart' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'datamart'
  
[0m13:43:09.080997 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m13:43:09.084735 [debug] [ThreadPool]: On list_datamart_datamart: ROLLBACK
[0m13:43:09.086488 [debug] [ThreadPool]: On list_datamart_datamart: Close
[0m13:43:09.096042 [debug] [MainThread]: Using postgres connection "master"
[0m13:43:09.096696 [debug] [MainThread]: On master: BEGIN
[0m13:43:09.097368 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:43:09.125934 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:43:09.126615 [debug] [MainThread]: Using postgres connection "master"
[0m13:43:09.127279 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:43:09.218639 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m13:43:09.221152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b437c0>]}
[0m13:43:09.222086 [debug] [MainThread]: On master: ROLLBACK
[0m13:43:09.227205 [debug] [MainThread]: Using postgres connection "master"
[0m13:43:09.227941 [debug] [MainThread]: On master: BEGIN
[0m13:43:09.229237 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:43:09.229881 [debug] [MainThread]: On master: COMMIT
[0m13:43:09.230485 [debug] [MainThread]: Using postgres connection "master"
[0m13:43:09.230982 [debug] [MainThread]: On master: COMMIT
[0m13:43:09.232951 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:43:09.233519 [debug] [MainThread]: On master: Close
[0m13:43:09.234646 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m13:43:09.235218 [info ] [MainThread]: 
[0m13:43:09.435561 [debug] [Thread-1 (]: Began running node model.points_balance_report.points_balance_report
[0m13:43:09.436711 [info ] [Thread-1 (]: 1 of 1 START sql incremental model datamart.points_balance_report .............. [RUN]
[0m13:43:09.437909 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_datamart_datamart, now model.points_balance_report.points_balance_report)
[0m13:43:09.438524 [debug] [Thread-1 (]: Began compiling node model.points_balance_report.points_balance_report
[0m13:43:09.451331 [debug] [Thread-1 (]: Writing injected SQL for node "model.points_balance_report.points_balance_report"
[0m13:43:09.453707 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (compile): 13:43:09.438930 => 13:43:09.453361
[0m13:43:09.454209 [debug] [Thread-1 (]: Began executing node model.points_balance_report.points_balance_report
[0m13:43:09.499661 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.500076 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

    
  
    

  create temporary table "points_balance_report__dbt_tmp134309479080"
  
  
    as
  
  (
    

SELECT 
  DATE('2023-12-1') AS tenant_date,
  customer.external_id AS customer_id,
  COALESCE(SUM(balance.points_balance), 0) AS available_points_balance
FROM
  "datamart"."datamart"."crm__customers" AS customer
LEFT JOIN
  "datamart"."datamart"."ledger__points_tranche_snapshots" AS balance
ON
  customer.id = balance.user_id
  AND balance.scd_valid_from at time zone 'aedt' <= DATE('2023-12-1')
  AND (balance.scd_valid_to at time zone 'aedt' >= DATE('2023-12-1') OR balance.scd_valid_to IS NULL)
  AND balance.expired_on > DATE('2023-12-1')
GROUP BY
  1,2
  );
  
  
[0m13:43:09.500362 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:43:09.745614 [debug] [Thread-1 (]: SQL status: SELECT 4 in 0.0 seconds
[0m13:43:09.757385 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.758117 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: BEGIN
[0m13:43:09.759351 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:43:09.759858 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.760351 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report__dbt_tmp134309479080'
        
      order by ordinal_position

  
[0m13:43:09.868459 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m13:43:09.876974 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.877622 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m13:43:09.887396 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m13:43:09.898216 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.898738 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "datamart".INFORMATION_SCHEMA.columns
      where table_name = 'points_balance_report'
        
        and table_schema = 'datamart'
        
      order by ordinal_position

  
[0m13:43:09.910954 [debug] [Thread-1 (]: SQL status: SELECT 3 in 0.0 seconds
[0m13:43:09.926416 [debug] [Thread-1 (]: Writing runtime sql for node "model.points_balance_report.points_balance_report"
[0m13:43:09.929104 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.929544 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: /* {"app": "dbt", "dbt_version": "1.7.7", "profile_name": "points_balance_profile", "target_name": "dev", "node_id": "model.points_balance_report.points_balance_report"} */

      
        
            delete from "datamart"."datamart"."points_balance_report"
            where (
                concat(tenant_date, customer_id)) in (
                select (concat(tenant_date, customer_id))
                from "points_balance_report__dbt_tmp134309479080"
            );

        
    

    insert into "datamart"."datamart"."points_balance_report" ("tenant_date", "customer_id", "available_points_balance")
    (
        select "tenant_date", "customer_id", "available_points_balance"
        from "points_balance_report__dbt_tmp134309479080"
    )
  
[0m13:43:09.971673 [debug] [Thread-1 (]: SQL status: INSERT 0 4 in 0.0 seconds
[0m13:43:09.987615 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m13:43:09.988083 [debug] [Thread-1 (]: Using postgres connection "model.points_balance_report.points_balance_report"
[0m13:43:09.988421 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: COMMIT
[0m13:43:10.038220 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:43:10.039350 [debug] [Thread-1 (]: Timing info for model.points_balance_report.points_balance_report (execute): 13:43:09.454491 => 13:43:10.039100
[0m13:43:10.039805 [debug] [Thread-1 (]: On model.points_balance_report.points_balance_report: Close
[0m13:43:10.040674 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc3466de-bef7-4cdc-893e-3f454414e570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b23310>]}
[0m13:43:10.041369 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model datamart.points_balance_report ......... [[32mINSERT 0 4[0m in 0.60s]
[0m13:43:10.042032 [debug] [Thread-1 (]: Finished running node model.points_balance_report.points_balance_report
[0m13:43:10.043722 [debug] [MainThread]: Using postgres connection "master"
[0m13:43:10.044150 [debug] [MainThread]: On master: BEGIN
[0m13:43:10.044505 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:43:10.077747 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:43:10.078322 [debug] [MainThread]: On master: COMMIT
[0m13:43:10.078658 [debug] [MainThread]: Using postgres connection "master"
[0m13:43:10.078967 [debug] [MainThread]: On master: COMMIT
[0m13:43:10.079646 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:43:10.080038 [debug] [MainThread]: On master: Close
[0m13:43:10.080731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:43:10.081046 [debug] [MainThread]: Connection 'model.points_balance_report.points_balance_report' was properly closed.
[0m13:43:10.081396 [info ] [MainThread]: 
[0m13:43:10.081762 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.05 seconds (2.05s).
[0m13:43:10.082410 [debug] [MainThread]: Command end result
[0m13:43:10.141126 [info ] [MainThread]: 
[0m13:43:10.141827 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:43:10.142327 [info ] [MainThread]: 
[0m13:43:10.142737 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:43:10.151180 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.2319, "process_user_time": 3.829207, "process_kernel_time": 1.199035, "process_mem_max_rss": "125599744", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:43:10.151934 [debug] [MainThread]: Command `dbt run` succeeded at 13:43:10.151756 after 8.23 seconds
[0m13:43:10.152544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10767a3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112eb28c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f618d0>]}
[0m13:43:10.153065 [debug] [MainThread]: Flushing usage events
